\chapter{Systematic Uncertainties}%
\label{ch:systematics}

So far the only errors considered are the random statistical errors on the data
and Monte-Carlo predictions. Systematic errors enter into the analysis in a
large number of places, in this chapter the systematic errors considered in the
analysis are detailed. In general the systematic errors come in one of two
forms, either a shape effect or a normalisation effect. Normalisation effects
alter the number of events in a given sample across the entire sample simply
changing the total number of events. Shape effects change where events lie in a
given distribution causing events to migrate between bins of a histogram, and
potentially across boundaries that are used to define analysis regions described
in~\ref{sec:ana-regions}.

A sub-category of normalisation effect is the acceptance effect which deals with
the normalisation in a particular region or set of regions. The purpose of the
acceptance uncertainties is to account for any mismodelling in the theoretical
prediction of the quantities used to categorise events into regions be it the
leptonic channel, jet multiplicity or an analysis region. Nuisance parameters in
the profile likelihood fit are used to control the acceptance, they are
implemented as Gaussian probability densities whose priors are estimated in
advance. The priors of all of these so called acceptance uncertainties are
calculated using the double ratio
\begin{equation}
  \left. \dfrac{N_{A}^{\text{nominal}}}{N_{B}^{\text{nominal}}} \middle/ \dfrac{N_{A}^{\text{alternative}}}{N_{B}^{\text{alternative}}} \right.,
  \label{eq:acceptance-dr}
\end{equation}
where the formula has been written agnostic of the specific application so
$N_{A}^{nominal}$ is the number of  events in the nominal prediction in some
region or category called $A$ and so on.

Another variant of the normalisation effect are the flavour composition
uncertainties. Rather than impacting the normalisation of an entire background
in terms of how they are categorised in the analysis plots, for example in the
plots in section~\ref{sec:prefit}, they impact the sub-processes split by
flavour of the decay products individually. A heavy flavour process is defined as
one where the two leading jets have flavour (b,~b), (b,~c), (b,~l), or (c,~c),
this categorisation is often written as hf for short for example when
considering all heavy flavour sub-process of the V + jets background one could
write V + hf. Flavour composition uncertainties affect the normalisation of one
of the flavour sub-processes with respect to one of the others, specific details
will follow under the sections relating to the relevant backgrounds.

The rest of this chapter will detail the sources of systematic error broken down
into groups of similar origin. Before breaking down each group of systematic
errors a technique called the Boosted Decision Tree Re-weighting method will be
explained as it used across a number of the different groups. The author's
contributions include the determination of all of the Z + jets systematic
errors, determination of systematic errors relating to the flavour composition
of simulated top process events, and development and testing of the Boosted
Decision Tree Re-weighting method.

\section{Parametrising Variance Due To Shape Uncertainties}
\label{sec:re-weighting}

The predictions entering into the profile-likelihood fit of the analysis can be
written as a probability density $p(\vec{x}|\vec{\theta})$, where $\vec{x} =
[x_{1},..., x_{i}]$ is a vector of observable quantities, with $N$ elements and
$\vec{\theta}$ represents the theoretical parameters of the model. The
parameters may come from the Standard Model theory or phenomenological
considerations that must be taken into account to turn that theory into a usable
prediction.

As described above, shape effects may impact the prediction of a given
Monte-Carlo generator that has a particular set of parameters. The choice of
generator will change the prediction due to different choices made by the
generator creators, including but not limited to, the parton shower model,
hadronisation model and non-perturbative processes. One way to get a handle on
the variance of a particular generator is therefore to literally vary these
choices by picking an alternative generator and drawing a comparison to the
alternative prediction. This method is flawed in ways which will be discussed
but is nonetheless fairly common and often one of the few choices available to
analysers when they are trying to get an idea of what the systematic errors on
the modelling of complex physics processes are. Two such methods of comparison
will be detailed here as they are used in this analysis, they the single
dimension parameterisation described in section~\ref{sec:1D-reweight} and a
multi-dimensional parameterisation described in section~\ref{sec:ND-reweight}.
Following this a hybrid approach which uses both methods will be described in
section~\ref{sec:hybrid-reweight}. These methods are described here in general
and then the specific implementations are discussed later under sections
relevant to the systematic errors they are used to calculate.

\subsection{Single Dimension Parameterisation}
\label{sec:1D-reweight}

The single dimension parameterisation uses the ratio of probability densities
\begin{equation}
  r(\vec{x}) = \frac{p(\vec{x}|\vec{\theta}_{1})}{p(\vec{x}|\vec{\theta}_{0})},
  \label{eq:DensityRatio}
\end{equation}
where the subscripts on $\vec{\theta}$ number different choices of the
parameters which govern the model, for example due to different choice of
generator. Here the subscript 0 denotes the nominal prediction and 1 denotes an
alternative. In order to map the nominal to the alternative it is clear that the
one can multiply $p(\vec{x}|\vec{\theta}_{0})$ by the ratio.

The only way that this calculation is tractable is to consider a single
dimension of the probability density function, specifically a single observable
chosen from the vector $\vec{x}$. The ratio then becomes
\begin{equation}
  r(x_{i}) = \frac{p(x_{i}|\vec{\theta}_{1})}{p(x_{i}|\vec{\theta}_{0})},
  \label{eq:1D-ratio}
\end{equation}
which can in turn be calculated for as many or as few as the elements of
$\vec{x}$ as is desired. It should be noted that when the ratio is calculated
using only a single variable it can still be used to map the $N$ dimensional
nominal prediction to the alternative, however the mapping is only guaranteed to
be successful in the dimension chosen to calculate the ratio and in general
agreement between the two predictions in the other variables can not be relied
upon.

Figure~\ref{fig:1d-rw-illustration} shows a graphical illustration of how this
single dimensional ratio is calculated. In practice the ratio is used to derive
a systematic shape uncertainty by weighting each event in the nominal
prediction as a function of the variable $x_{i}$ whose distribution was used to
calculate the ratio. Limitations on the sample size of each prediction mean that
in practice it is better to smooth the ratio via the use of a parametric fit in
order to mitigate any large statistical fluctuations in a single bin of the
ratio (arising from a large fluctuation in one of the predictions in that bin).
In figure~\ref{fig:1d-rw-illustration} the parametric fit is represented by the
solid line in the ratio.
\input{07-systematic-errors/re-weighting-illustration}

\subsection{$N$-dimensional Parametrisation}
\label{sec:ND-reweight}

As already alluded to in the previous section there are issues with the
parametrisation in a single dimension. Not only is the mapping only guaranteed
to work in a single dimension but if the technique is applied sequentially on
one variable after another the mapping from the first step can be undone by the
second. That is to say that if one calculates the ratio~\ref{eq:1D-ratio} with
$i=1$ and $i=2$ the re-weighting by $r(x_2)$ will not preserve the agreement
between the two predictions that would be achieved by the re-weighting with
$r(x_1)$. It is clear that this is because a ratio for a given $x_i$ only encode
information relating to the PDFs $p(x_i|\theta_0)$ and $p(x_i|\theta_1)$ whereas
what is wanted is something that encodes the multi-variate distributions
$p(\vec{x}|\theta_0)$ and $p(\vec{x}|\theta_1)$.

A function capable of providing compression of the full multi-variate
distribution has already been discussed, these are the functions that one
obtains when training a machine learning algorithm such as those mentioned
in chapter~\ref{ch:ml}. Functions of the form given in
equation~\ref{eq:ml-general} can encode information from the multi-variate
input $\vec{x}$ into a lower dimensional $\vec{y}$ that captures the
correlations between the different elements of the inputs $\vec{x}$.
Specifically for this parametrisation the model is trained to classify events as
coming from either the Monte-Carlo generator with parameters $\theta_0$ or
$\theta_1$, the output is therefore written as $\vec{y} = [y_0, y_1]$ where each
term in the vector represents the probability that an event comes from
$p(\vec{x} | \theta_0)$ or $p(\vec{x} | \theta_1)$ respectively. Note that the
choice of output function in the model ensure that probability is conserved,
i.e. $y_0 + y_1 = 1$. This technique has been demonstrated in the
literature~\cite{cranmer2016approximating} where the mathematical details are
discussed in more detail.

Our setup allows to create the following approximation
\begin{equation}
  r(\vec{x}) =  \frac{p(\vec{x}|\vec{\theta}_{1})}{p(\vec{x}|\vec{\theta}_{0})}
  \approx \frac{F(\vec{x}, \vec{w})[1]}{F(\vec{x}, \vec{w})[0]},
  \label{eq:bdtr-approximation}
\end{equation}
where $F$ is our trained model whose hyper-parameters we can considered fixed
and drop from the notation (previously denoted $\vec{\theta}$ in
chapter~\ref{ch:ml}). The numbers in the square brackets indicate which element
of the $\vec{y}$ is being selected. Once the above approximation is made the
steps to generate weights and perform a parameterisation of the difference in
shape between two predictions is the same as in the one dimensional case. By
placing certain restrictions on $F$ one can turn the approximation into an
equivalence, this is discussed in~\cite{VHModellingNote2019}, however for what
is considered here the approximation will be the focus.
Figure~\ref{fig:nd-rw-illustration} shows an illustration of the
$N$--dimensional parametrisation procedure.
\input{07-systematic-errors/nd-reweighting-illustation}
This parametrisation will be referred to in the analysis as the BDTr method
short for BDT re-weighting as the choice of classifier is a BDT.

\subsection{Hybrid $\bm{(N - 1)}$--Dimensional Parametrisation}
\label{sec:hybrid-reweight}

It is possible to combine the aforementioned parametrisation strategies into a
single strategy. This is achieved by first re-weighting using the 1--dimensional
technique and then training the classifier on the re-weighted distributions and
proceeding with the $N$--dimensional parametrisation as usual. In principle the
1--dimensional re-weighting can be performed a number of times sequentially
before training the classifier and so therefore a general $(N-k)$--dimensional
strategy can be formed, however in this analysis the 1--dimensional re-weighting
is only applied once before training.

The hybrid approach yields two parametrisations one that parametrising the
difference between the two samples in the single variable used in the
1--dimensional re-weighting and a second that parametrises the remaining
variables using the density ratio formed by using the classifier trained on the
re-weighted distributions. This approach will be referred to as the factorised
BDTr method as the single variable that is not included in the classifier that
is used to generate the multi-dimensional parametrisation is considered to be
factored out.

There are a number of reasons why one might want to factor out a single variable
from the multi-dimensional procedure that naively looks superior in every way to
the 1--dimensional approach. One must considered that when comparing two
Monte-Carlo based generators internal parameters may be used in one of those
generators that are not used in other, this is one reason why a smooth
interpolation between generators may not actually exist. Given that the
parametrisation generated by any of these methods will be input into a
profile-likelihood fit as a Gaussian constrained nuisance parameter that is
varied in a smooth and continuous manner there is therefore incongruity between
the nature of the nuisance parameter and the underlying mapping between
generators. A second nuisance parameter arising from the factorised variable
therefore at least allows the profile-likelihood fit to control more precisely
the histograms relating to that variable. The choice of factorised variable is
also relevant to the choice of using the hybrid method, for example in the fit
the histograms entering in the control regions are of $P_T^V$ and so it may be
sensible to give the fit a parameter to directly control the shape of this
variable.

\section{Experimental Systematic Uncertainties}

This section describes experimental systematic uncertainties, these arise due to
limitations of the hardware discussed in chapter~\ref{ch:detector} and
reconstruction algorithms described in chapter~\ref{ch:recon}. All of these
uncertainties are provided by different combined performance (CP) groups and
made centrally available to members of the ATLAS collaboration, this ensures a
consistent understanding of the performance of the detector and centrally
provided reconstruction algorithms in Athena. A summary of all of the
experimental systematic uncertainties used in the analysis can be found in
table~\ref{tab:expSyst}.
\input{07-systematic-errors/experimental-table.tex}

\subsection{Luminosity and Pile-up}
\label{sec:lumisys}

As discussed in chapter~\ref{ch:detector} luminosity is used to measure how much
data is recorded by the detector in any span of time. The uncertainty is
calculated for each year of running and is determined to be  2.1\%, 2.6\%,
2.4\%, and 2.0\% for the years 2015, 2016, 2017, 2018 respectively. A combined
uncertainty is calculated for the entire period 2015--2018 at 1.7\%. The
methodology used to calculate this figure is similar to that detailed
in~\cite{lumiDetermine}, from calibrations of the luminosity scale using x--y
beam-separation scans~\cite{lumiTwiki}.

Pile-up uncertainties are computed by changing the nominal data scale of
$1.0/1.03$ to $1.0/1.00$ and $1.0/1.18$ to get the up and down variations
respectively~\cite{puTWiki}.

\subsection{Triggers}
\label{sec:trigsys}

\subsubsection{\texorpdfstring{$E_T^{\text{miss}}$}{MET} Triggers}

Scale factors are derived for the $E_T^{\text{miss}}$ triggers using
$W(\mu,\nu)$ + jets events as outlined in~\cite{VHObjectNote2019}.

Three uncertainties are taken into account, the statistical error on the dataset
used to derived the scale factor \texttt{METTrigStat}, a parameter used to
account for the choice of physics process and the effect that might have on the
determination of the scale factor \texttt{METTrigTop} and \texttt{METTrigSumPt}
which aims to account for dependence of the offline $S_T$ (as defined
in~\ref{sec:0lep-selection}) on the trigger efficiency. The uncertainty
\texttt{METTrigTop} is named as such because it is derived from a comparison of
the scale factors as calculated with a $t\bar{t}$ sample and compared to the
nominal sample. The uncertainty relating to $S_T$ is only applied to events
recorded in 2017 due to a specific trigger used in this year.

\subsubsection{Lepton trigger}

The CP group recommendations for the lepton triggers can be found
in~\cite{VHObjectNote2019}. The group provide a tool for determining the lepton
trigger systematic error which is implemented in the CxAOD Framework (mentioned
in section~\ref{sec:cxaod}). The nuisance parameter
\texttt{EL\_EFF\_Trigger\_Total\_1NPCOR\_PLUS\_UNCOR} is used to control the overall
uncertainty on the electron trigger. For the muons, the tool returns two components
\texttt{MUON\_EFF\_TrigSystUncertainty} and \texttt{MUON\_EFF\_TrigStatUncertainty}
which account for the systematic error and the statistical error on scale factor
respectively. An up and down variation of 1-$\sigma$ are used for all of the
aforementioned nuisance parameters.

\subsection{Electrons}

\subsubsection{Electron Efficiency Uncertainties}

The efficiency of the electron reconstruction and identification (discussed
in~\ref{subsec:electrons}) has a systematic uncertainty provided by the relevant
CP group called \texttt{ElectronEfficiencyCorrection}~\cite{electronTWiki}.
These have been calculated using the full run 2 data. Reconstruction is 97-99\%
efficient across the full $p_T$~spectrum. Identification has an efficiency scale
factor is available from $p_T>7$~\GeV. An isolation efficiency scale factor is
also included. The latest uncertainties that are available include scale factors
for $p_T>150$~\GeV\ that are unity due to the available sample being to small in
statistics to measure a scale factor~\footnote{Check if this is for all electron
  systs}. An additional systematic uncertainty of $\pm 2\%$ is assigned above
150~\GeV\ to over this shortcoming. The above uncertainties are controlled by
\texttt{EL\_EFF\_ID\_Total\_1NPCOR\_PLUS\_UNCOR},
\texttt{EL\_EFF\_Reco\_Total\_1NPCOR\_PLUS\_UNCOR}, and
\texttt{EL\_EFF\_Iso\_Total\_1NPCOR\_PLUS\_UNCOR} in the profile-likelihood fit.

\subsubsection{Electron Energy Scale and Resolution Uncertainties}

Energy scale and resolution systematic uncertainties have been provided by the
relevant CP group~\cite{EgammaCalibTWiki}. Whilst there are a large number of
uncertainties provided by the group, this analysis is not very sensitive to the
energy scale or resolution of electrons and therefore only two uncertainties are
considered which are called \texttt{EG\_RESOLUTION\_ALL} and
\texttt{EG\_SCALE\_ALL}.

\subsection{Muons}

\subsubsection{Muon Efficiency Systematic Uncertainties}

Samples of $Z \to \mu\mu$ and $J/\psi \to \mu\mu$ events from the full 2015
dataset (corresponding to 3.2~\invfb) are used to calculate scale factors to
account for uncertainties in the reconstruction, isolation and track-to-vertex
association~\cite{muonTWiki}. These scale factors are valid in the full $p_T$
spectrum with the $J/psi$ measurement providing more accurate determination in
the $p_T$<15~\GeV\ region and the Z measurement being more accurate in the
$p_T$>15~\GeV\ region. Four independent systematic uncertainties are considered
which are called \texttt{MUON\_EFF\_RECO\_STAT},

\texttt{MUON\_EFF\_RECO\_STAT\_LOWPT}, \texttt{MUON\_EFF\_RECO\_SYS},
\texttt{MUON\_EFF\_RECO\_SYS\_LOWPT}, which are split based on whether or not
they come from the high or low $p_T$ measurement. Statistical and systematic
uncertainties to the isolation scale factor are controlled by
\texttt{MUON\_EFF\_ISO\_STAT} and \texttt{MUON\_EFF\_ISO\_SYS} respectively.
They are supported in the range of $10 < p_T < 500$~\GeV. For muons outside of
this range, a scale factor of 1$\pm$0.05 is used.
\texttt{MUON\_EFF\_TTVA\_STAT} and \texttt{MUON\_EFF\_TTVA\_SYS} control the
systematic uncertainty on the scale factor of the cuts on the impact parameter
significance and the $|z_0\sin\theta|$ which estimate the error on
track-to-vertex association. All of the above systematic uncertainties are
derived using $\pm 1\sigma$ variations in the relevant samples.

\subsubsection{Muon Momentum Scale and Resolution Uncertainties}

Similarly to the electron energy scale and resolution uncertainties described
above the muon momentum scale and resolution uncertainties are provided by the
relevant CP group~\cite{muonTWiki}. Measurements of muons have been calibrated
using a sample of  $Z\rightarrow \mu\mu$ events in the region with
$p_T$~>~20~\GeV\ and with a sample of $J/\psi\rightarrow \mu\mu$ events in region
with $p_T$~<~20~\GeV. The nuisance parameters control the uncertainties due to
the inner detector, muon system and the overall momentum scale, they are called
\texttt{MUONS\_ID}, \texttt{MUONS\_MS} and \texttt{MUONS\_SCALE} respectively.
These systematic uncertainties are derived by varying the momentum scale and the
track position in the detector by $\pm 1\sigma$. Two parameters which account
for the charge dependence of the of the momentum scale uncertainty
\texttt{MUON\_SAGITTA\_RHO} and \texttt{MUON\_SAGITTA\_RESBIAS} are also included.

\subsection{Taus}

Taus are not crucial to the analysis and therefore the systematic uncertainties
on the measurement of taus does not have a large effect on the result. The
systematic uncertainties considered in the analysis relating to taus are
\texttt{TAUS\_TRUEHADTAU\_SME\_TES\_DETECTOR},
\texttt{TAUS\_TRUEHADTAU\_SME\_TES\_INSITU} and
\texttt{TAUS\_TRUEHADTAU\_SME\_TES\_MODEL}, which all account for different
sources of energy scale uncertainty.

\subsection{Jets}

As with the other reconstructed objects discussed so far the systematic
uncertainties for jets are provided through a central tool written by the
relevant CP group that is interfaced in the CxAOD Framework. Analyses may choose
between a number of different schemes, the choice for the VH(bb) analysis is to
use a reduced set of 23 nuisance parameters comi
ng from a reduction using
principal component analysis of the baseline set of parameters. The baseline set
accounts for effects due to eta calibration, high-$p_T$ jets, pile-up, flavour
composition, flavour response, $b$-jets, and punch-through jets. The 23 nuisance
parameters and a short description of each are displayed in
table~\ref{tab:expSyst} under the category jets and $b$-tagging where all of the
relevant nuisance parameters start with \texttt{JET} and
\texttt{JET\_CR\_Flavour\_Composition} represents three independent nuisance
parameters as explained in its short description.

The largest source of uncertainty amongst the chosen set come from the jet
energy scale and the jet energy resolution. The determination of the former is
documented in~\cite{JetCalibration2015} and the latter is determined from data
versus Monte-Carlo prediction comparisons.

\subsection{$E_T^{\text{miss}}$}

Once again $E_T^{\text{miss}}$ systematic uncertainties are implemented via a
centrally available tool written by the relevant CP group and interfaced in the
CxAOD Framework. The tool is configured to account for calorimeter and track
based jets, the uncertainties considered in this analysis are under the heading
$E_T^{\text{miss}}$ in table~\ref{tab:expSyst} and start with \texttt{MET}.

\subsection{Flavour Tagging}

The uncertainties relating to the flavour tagging procedure detailed
in~\ref{sec:btagging} are very important to consider in the analysis as the
tagging itself has a central role in selecting events in all of the leptonic
channels. Each event that has been passed through the tagging algorithms has
event weights that encode the systematic error on the tagging. The following
describes how these scale factors are calculated with reference to the tool
provided by the relevant CP group. For each signal events apply the scale factor
from the CP tool if it has been tagged as a $b$-jet, otherwise apply the
inefficiency scale factor provided by the same tool (which yields the nominal
event weight). For each of the systematic uncertainties considered vary the
scale factor and inefficiency scale factor by the variations provided by the CP
tool and repeat the previous method (note the varied inefficiency scale factor
will no longer yield the nominal event weight). For all histograms that would
enter the profile-likelihood fit a separate histogram is created for each
systematic uncertainty (both an up and down variation where the uncertainties
are two-sided).

Similarly to in the determination of the systematic uncertainties on the jets, a
large number of individual systematics are available (about 40 per jet flavour)
and so in order to have a smaller set to work with a principle component
analysis of the full set is performed by the CP group. For the working point
(70~\%) and reduction scheme chosen in this analysis there are 3 variations for
$b$-jets, 3 variations for $c$-jets and 5 variations for light-jets. These are
named \texttt{FT\_EFF\_Eigen\_Light0}, \texttt{FT\_EFF\_Eigen\_Light1},
\texttt{FT\_EFF\_Eigen\_Light2}, \texttt{FT\_EFF\_Eigen\_Light3},\\
\texttt{FT\_EFF\_Eigen\_Light4}, \texttt{FT\_EFF\_Eigen\_B0},
\texttt{FT\_EFF\_Eigen\_B1}, \texttt{FT\_EFF\_Eigen\_B2},
\texttt{FT\_EFF\_Eigen\_C0}, \texttt{FT\_EFF\_Eigen\_C1} and
\texttt{FT\_EFF\_Eigen\_C2}.

Two additional systematic uncertainties irrespective of reduction scheme are
considered that relate to the $p_T$ extrapolation~\cite{BTaggingExtrap2015} and
charm-to-bottom quark extrapolation, they are called
\texttt{FT\_EFF\_Eigen\_extrapolation}, and
\texttt{FT\_EFF\_Eigen\_extrapolation\_from\_charm} respectively.

\section{Systematic Uncertainties on V + jets Events}
\label{sec:vjets}
Whilst the physics of the W and Z + jets processes leads to them being in
different channels and needing to be treated differently in the analysis, the
underlying theory means that simulation of these processes is coupled,
particularly as they are simulated with the same software.

The V + jets processes are simulated with
\textsc{Sherpa}~2.2.1~\cite{1126-6708-2009-02-007} as mentioned in
section~\ref{sec:composition}, which is interfaced with the
NNPDFs~\cite{Ball:2012cx} for both the matrix element calculation and the parton shower
tuning. Events with many additional jets produced in association with the vector
boson largely contribute to the background in this analysis, therefore a feature
of \textsc{Sherpa}~2.2.1 is used in which it provides a combination of matrix
elements with different parton multiplicities. Up to 2 extra partons are
included in the next-to-leading order matrix element, and 3 or 4 extra partons
are included at leading order in QCD. In order to combine different patron
multiplicities a matching scheme based on the CKKW-L~\cite{Lonnblad:2001iq,
  Lavesson:2005xu} merging technique is used, with a merging scale of $Q_{cut} =
20$~\GeV. Simulation of events with more than 4 extra partons relies on the
parton shower algorithm of \textsc{Sherpa}. The parton shower and underlying
events models are included in \textsc{Sherpa} whose generator adopts a full
5--flavour scheme with b- and c-quarks being treated as massless in the matrix
element, in the version used. Massive quarks can be produced in the parton
shower and heavy flavours (quarks as heavy or heavier than a c-quark) can be
produced directly in the scattering process of the underlying event.

The analysis gains a lot of sensitivity from high $p_T^V$ regions of phase
space, and also has the requirement of two b-tagged jets in the event selection
as mentioned in section~\ref{sec:selection}. It is therefore important to ensure
that a large statistical sample in these regions is available such that
fluctuations are smaller than those that would be found in the data. In order to
achieve this two methods are used, firstly samples are simulated in specific
slices of the larger of the $p_T$ of the vector boson or the $H_T$ of the event.
Events are simulated in the following slices
\begin{equation}
  \text{max}(p_T^V, H_T) = [0\text{--}70, 70\text{--}140, 140\text{--}280, 280\text{--}500, 500\text{--}1000, >1000]~\GeV.
\end{equation}
The dedicated slices at high $\text{max}(p_T^V, H_T)$ ensure a large number of
events are simulated in the high $p_T^V$ region of phase space. Secondly filters
are applied on the flavour of the jets that produced in association with the
vector boson.  The filters used for these samples are shown in
table~\ref{tab:bc-filters}.
\input{07-systematic-errors/bc-filters}
The filters are not applied to the highest slices in $\text{max}(p_T^V, H_T)$.
The filtering strategy for $Z\nu\nu$ samples differs in the mc16e campaign using
a combination of $p_T^Z$ and $m_{jj}$ to better populate the region above the
MET trigger thresholds, and VBF phase spaces with high $m_{jj}$. These samples
also use a tighter b-filter compared to their mc16a/d counterpart which is also
described in table~\ref{tab:bc-filters}. All nominal V + jets samples with the
corresponding max($H_T$,$p_T^V$) slices and flavour filters are listed in
tables~\ref{tabular:mc_samples_Wjets} \ref{tabular:mc_samples_Zlljets}, and
\ref{tabular:mc_samples_Zvvjets} in the appendices.
+
A set of alternative predictions are used for a number of purposes in the
analysis, one such purpose is to investigate any discrepancies that may arise
between data and the nominal prediction. If the same discrepancy is present when
comparing he alternative prediction to data then the discrepancy may arise from
experimental error rather than weaknesses in the modelling. One kind of
modelling uncertainty also relies on the comparison of two predictions, for
example the nominal versus the alternative.

The alternative samples are generated using
\textsc{MadGraph}~5~\cite{MADGRAPH5_aMC@NLO} interfaced to \textsc{Pythia}~8 for
the modelling of the parton shower and the underlying event. The
\textsc{MadGraph}~5 v2 generator provides a LO (QCD) description of these
processes, merging together matrix-element calculations with different parton
multiplicities, up to 4 additional jets, higher jet multiplicities are modelled
by the parton shower algorithm. The merging scheme applied to combine different
parton multiplicities is the same as for the nominal samples, the CKKW-L scheme,
but has a merging scale of $Q_{cut} = 30$~\GeV. For the LO ME calculation the
NNPDF2.3 LO PDFs are used, with $\alpha_S = 1.3$.  Similarly to
\textsc{Sherpa}~2.2.1, also \textsc{MadGraph}~adopts a full 5-flavour scheme
with massless quarks in the ME calculation, while massive quarks can be produced
by the parton shower. All alternative V + jets samples are listed in
tables~\ref{tabular:zjetsAlternativeSamples} and
\ref{tabular:wjetsAlternativeSamples} in the appendices.

As well as using an alternative Monte-Carlo generator the nominal generator,
\textsc{Sherpa}, includes systematic variations internally. Every
\textsc{Sherpa}~2.2.1 V + jets sample has an event weight corresponding to each
of the variations detailed in table~\ref{tab:sherpa-variations}\footnote{Some of
the variations cannot be produced by \textsc{Sherpa}~2.2.1 and so
\textsc{Sherpa}~2.1 is used instead. For these variations half of the variation
in each direction is taken as the uncertainty rather than comparing to the
central value of the \textsc{Sherpa}~2.2.1 prediction.}.
\input{07-systematic-errors/vjets-sherpa-vars.tex}

\subsubsection{V + jets Cross Section}
The V + jets cross sections are known at NNLO (QCD)~\cite{Butterworth:1287902},
the higher order cross sections are used to normalise the V+jets samples in the
analysis. For the W + jets samples the total cross section from \textsc{Sherpa} or
from \textsc{MadGraph}, averaged across all 3 lepton flavours taking into account the
different hadron filter efficiencies, is scaled to the NNLO prediction obtaining
scaling factor of $k_{\text{NNLO}}^{\text{QCD}} = 0.9702$.

For Z + jets some subtleties must be considered. For $Z \to \ell\ell$ + jets the
cut at generator level, $m_{\ell\ell}>40$ \GeV, must be taken into account. The
NNLO calculation uses a cut of $66<m_{\ell\ell}<116$ \GeV, which can be applied
at truth level to the samples of this analysis in order to get the scaling
correct as follows:
\begin{equation}
  k_{\text{NNLO}}^{\text{QCD}} = \frac{\sigma_{\text{NNLO}}(66<m_{\ell\ell}<116\,{\GeV})}{\sigma_{\textsc{Sherpa},\textsc{MadGraph}}(66<m_{\ell\ell}<116\,{\GeV})},
  \label{eq:nnlo-vjets-k}
\end{equation}
hence the scaling factor is found to be $0.9751$. For $Z \to \nu\nu$ +jets the
NNLO no theoretical cross section is available. Values from the
Particle Data Group (PDG)~\cite{PDG} are used to correct for the difference
between the BR($Z \to \nu\nu$) and BR($Z \to \ell\ell$), and the NNLO cross
section is used without any mass cuts and with the $Z/\gamma^*$ interference
removed. The scaling factor is therefore calculated to be $0.9728$. It is not
necessarily expected that the scaling factors should be different for $Z \to
\ell \ell$ and $Z \to \nu \nu$ events but this can be explained as both
\textsc{Sherpa} and \textsc{MadGraph} used different branching ratios for these
two processes in their generators compared with those used by the higher order
theoretical calculations.

\subsection{Systematic Uncertainties on W + jets Events}
A number of nuisance parameters are introduced to account for modelling
uncertainties on the W + jets background process. These uncertainties are
considered and derived in the 0-- and 1-- lepton channels only as the amount of
W + jets background present in the 2--lepton channel is negligible. A summary of
all of the uncertainties for this background can be found in
table~\ref{tab:wjets_systematics}.

The nominal and alternative predictions described in~\ref{sec:vjets} are used to
in the determination of all of the values described in the following. 

\subsubsection{Normalisation and Acceptance Uncertainties}

A summary of the normalisation uncertainties is shown in
table~\ref{tab:wjetsnorm}.
\input{07-systematic-errors/wjets-norm-table}
A single nuisance parameter is introduced for each of the W + cl and W + l
processes which are both heavily suppressed by the analysis requirement of two
b-tagged jets. There is a large mismodelling of the normalisation of the W + hf
process and so floating normalisations are used separately in the 2--jet and
3--jet categories. Priors for several acceptance uncertainties are calculated using
equation~\ref{eq:acceptance-dr}\footnote{Whilst the priors are obtained with the
  double ratio formula involving two regions, the effect of the uncertainty is
  applied to only one of the two regions. This does not affect the result but
  only the interpretation of the resulting acceptance factor.} which are used to
control the migration of events between the 0-- and 1--lepton channels and the
migration between the $\Delta R(b, \bar{b})$ regions.

The parameter controlling migration between the two leptonic channels
\texttt{SysWbbNorm\_L0} is applied to both the 2--jet and 3--jet regions of the
0--lepton channel. The choice to apply to the 0--lepton channel and not the
1--lepton channel is made because the 1--lepton channel provides a better
constraint on the W + hf process. Whilst all alternative predictions are
considered the size of this prior is dominated by the difference between the
nominal prediction and \textsc{MadGraph}.

Migration between the $\Delta R(b, \bar{b})$ control regions and the signal
region is controlled by one parameter per control region. Named
\texttt{SysWbbCRSRextrap} it can be seen in table~\ref{tab:wjetsnorm} that it is
applied in each of the control regions, it is also correlated across jet
multiplicity and leptonic channel. The shape uncertainty which uses the BDTr
method discussed in section~\ref{sec:ND-reweight} induces migration effects
across the analysis regions, however in order to increase the degrees of freedom
available to the profile-likelihood fit that systematic is taken as a shape only
effect. The migrations induced by the shape uncertainty agree well with those
derived from comparisons between nominal and alternative predictions, and the
sign of the final priors is determined by migration due to the shape
uncertainty. The magnitude of the prior is calculated as the quadrature sum of
the difference between the nominal prediction and \textsc{MadGraph} as well as
the scale and parton density function variations included in \textsc{Sherpa}.
There is no dedicated nuisance parameter to control the migration between the
$p_T^V$ regions of the analysis as this migration is controlled by the $p_T^V$
shape uncertainty.

\subsubsection{Flavour Composition Uncertainties}

As introduced at the start of this chapter the W + jets background has a W + hf
component that is comprised of the $bb$, $bc$, $bl$ and $cc$ sub-components. The
fractional contribution of each of these sub-components is detailed in
table~\ref{tab:whf-comp}.
\input{07-systematic-errors/whf-components}
Flavour composition uncertainties are computed using
equation~\ref{eq:acceptance-dr} for each sub-component, the calculated priors
are summarised in tables~\ref{tab:wjets-flavour-comp} separately in the 0-- and
1--lepton channels~\footnote{Whilst these numbers were calculated using the
  categorisation and samples of this analysis, due to incomplete availability of
  \textsc{Sherpa} internal variations a set of numbers calculated in a previous
  iteration of the analysis are displayed and used.}.
\input{07-systematic-errors/wjets-flavour-comp}
The flavour composition uncertainties are dominated by the difference between
\textsc{Sherpa} and \textsc{MadGraph}. Individual uncertainties for different
jet multiplicities or analysis regions are not considered necessary due to a
small amount of non-$bb$ events remaining after the 2 b-tag requirement is
imposed.

\subsubsection{Shape Uncertainties}

The hybrid $(N-1)$--dimensional parametrisation technique described
in~\ref{sec:hybrid-reweight} is used to generate uncertainties on the shape of
the distributions of the W + jets background. The variable that has been
factorised out is $p_T^V$ and so there are nuisance parameters which control the
$p_T^V$ shape in each of the 2-- and 3--jet categories as well as a nuisance
parameter that controls the multi-variate shape uncertainty across all regions
and jet multiplicities. These nuisance parameters are summarised in
table~\ref{tab:wjets-shapes}.
\input{07-systematic-errors/wjets-shapes-table}

Shapes are derived in regions split by leptonic channel and heavy flavour
sub-component, yielding eight regions total. The W + l and W + cl components of
the W + jets backgrounds are not considered as they account for less than 1~\%
of all background events in any region.

In all regions the initial 1--dimensional re-weighting is performed by comparing
the ratio of the nominal \textsc{Sherpa}~2.2.1 $(p_T^V, E_T^{\text{miss}})$
prediction with that of \textsc{MadGraph}. The requirement of $p_T^V~>~75$~\GeV\
is applied to all distributions in the 1--lepton channel and in the 0--lepton
channel the requirement of $E_T^{\text{miss}}~>~150$~\GeV\~is imposed instead.

Figures~\ref{fig:wjets_1lep_2jet_SysWPtVBDTr}
and~\ref{fig:wjets_1lep_3jet_SysWPtVBDTr} show the comparison between
\textsc{Sherpa} and \textsc{MadGraph} in the  $p_T^V$ variable in the 2-- and
3--jet categories, respectively. 
\input{07-systematic-errors/wjets-1lep-ptv-shapes}
The systematic uncertainties on the shape are shown in the ratio panel at the
bottom of each plot in green.

The low number of events available in the 0--lepton channel mean that it is not
statistically viable to generate a parametrisation in that channel, therefore
the shapes derived in the 1--lepton channel are also used in the 0--lepton
channel. Figure~\ref{fig:wjets_01lep_2jet_SysWPtVBDTr}
and~\ref{fig:wjets_01lep_3jet_SysWPtVBDTr} show a comparison of the $p_T^V$
shapes derived in the 1--lepton channel compared with the equivalent systematic
derived in the 0--lepton channel in the $E_T^{\text{miss}}$ variable for the 2--
and 3--jet categories, respectively.
\input{07-systematic-errors/wjets-01lep-ptv-shapes}
It can be seen the two shapes mostly agree within the statistical error which is
of course very large for the 0--lepton systematic. Furthermore
figure~\ref{fig:wjets_01lep_2jet_bl_SysWPtVBDTr_From150} shows  a comparison in
which both the $p_T^V$ and the $E_T^{\text{miss}}$ shapes in the 2--jet region
have been normalised to unit area in the $(p_T^V, E_T^{\text{miss}}) > 150$~\GeV\
range where it can be seen that agreement is event better further supporting the
validity of this choice.
\input{07-systematic-errors/wjets-01lep-ptv-shapes-norm}

As per the methodology of the factorised BDTr technique the nominal
\textsc{Sherpa}~2.2.1 events are re-weighted by the $p_T^V$ ratio with the
alternative prediction as was just discussed. The $p_T^V$ shape uncertainty is
therefore factorised out of the BDTr shape uncertainty. The re-weighted
\textsc{Sherpa}~2.2.1 events are then trained against the \textsc{MadGraph}
prediction in a BDT classifier that uses the input variables detailed in
table~\ref{tab:MVAinputs}. A separate training is performed in each jet category
and for each sub-component of the W + hf process in congruence with the 8
regions that the $p_T^V$ shape was derived in. Considering the output of the
classifier the ratio of the scores of the nominal and alternative predictions
enter into the profile-likelihood fit as a nuisance parameter called
\texttt{SysBDTr\_W\_SHtoMG5}. All of the following plots shown contain only W +
bb events as this is the dominant and most important component of the W + hf
process and indeed the W + jets background in the analysis.

In order to check the validity of the method the re-weighted nominal predictions
of key inputs to the analyisis MVA are plotted against the nominal and
alternative predictions in figures~\ref{fig:wjets_1lep_2jet_BDTrClosure_1}
and~\ref{fig:wjets_0lep_2jet_BDTrClosure_1} for the 1-- and 0--lepton channels
respectively in the 2--jet category.
\input{07-systematic-errors/wjets-bdt-shapes-1lep2jet}
\input{07-systematic-errors/wjets-bdt-shapes-0lep2jet}
Should the re-weighted nominal inputs match
the shapes of the alternative inputs then the method is considered to be valid.
Indeed upon inspection one can see that this is largely the case across the
board apart from small levels of disagreement. These small levels of
disagreement are disregarded as the two most important variables in the
determination of the analysis BDT score, $m(b, \bar{b})$, $p_T^V$ and
$E_T^{\text{miss}}$ have good levels of agreement.

The actual effect of the factorised BDTr systematic uncertainty on the analysis
BDT score is shown in figures~\ref{fig:wjets_1lep_FullRun2MVA_BDTrClosure}
and~\ref{fig:wjets_0lep_FullRun2MVA_BDTrClosure} for the 1-- and 0--lepton
channels respectively. 
\input{07-systematic-errors/wjets-bdt-shapes-mva-1lep}
\input{07-systematic-errors/wjets-bdt-shapes-mva-0lep}
Tables~\ref{tab:wjets-extrapolation_uncertainties_pTV}
and~\ref{tab:wjets-extrapolation_uncertainties_BDTr} in the appendix show the
extrapolation uncertainties induced by the $p_T^V$ and factorised BDTr shape
systematic uncertainties respectively.
\clearpage
\newpage

\subsection{Systematic Uncertainties on Z + jets Events}
\label{sec:zjets-systs}

Systematic uncertainties are considered in the 0-- and 2--lepton channels only
as there is a negligible contribution of this background in the 1--lepton channel.

\subsubsection{Normalisation and Acceptance Uncertainties}

Several normalisation and acceptance uncertainties are considered for the Z +
jets background, they are summarised in table~\ref{tab:zjetsnorm}.
\input{07-systematic-errors/zjets-norm-table}
One nuisance parameter is used for each of the Z + l and Z + cl components as
they are sub-dominant accounting for less than 1~\% of the total background in
any region due to the requirement of two b-tags, they are called
\texttt{SysZlNorm} and \texttt{SysZclNorm} respectively. These normalisations
are each correlated across all regions.

The Z + hf process has a large normalisation uncertainty and so therefore the
decision is made to have separate nuisance parameters for the 2--jet and 3--jet
regions, these are called \texttt{norm\_Zbb\_J2} and \texttt{norm\_Zbb\_J3}
respectively. These parameters are heavily constrained in the fit due to a very
large number of Z + jets events in the 0-- and 2--lepton signal regions and due
to high Z + jets purity particularly in the 2--lepton control regions.

Nuisance parameters are introduced to the model migration of events between
regions. The priors for these parameters are calculated using the double ratio
in equation~\ref{eq:acceptance-dr}. Firstly a parameter is introduced in order
to account for the difference in the number of Z + jets in the 0-- and 2--lepton
channels, is it called \texttt{SysZbbNorm\_0L} and is applied to Z + hf events
in the 0--lepton channel as the 2--lepton channel has a higher purity of Z +
jets events and therefore yields a better constraint on the normalisation. The
size of these priors as calculated by comparing \textsc{Sherpa}~2.2.1
and\textsc{MadGraph} is similar to the size as calculated by examining the
\textsc{Sherpa} internal weights.

The nuisance parameter that controls the Z + jets $p_T^V$ uncertainty,
\texttt{SysZPTV} (see section~\ref{sec:zjets-shapes}), is also allowed to
control the relative number of events between analysis regions. This choice is
made as the magnitude of the extrapolation uncertainties shown in
table~\ref{tab:zjets-ptv-extrap} are similar in size to the largest variations
one would obtain by comparing the nominal prediction to the alternatives.
\input{07-systematic-errors/zjets-shape-yield-effect}

In the case of $m_{bb}$ the uncertainty on the normalisations that would be
induced by the shape does not cover the differences that arise from comparison
of the different available predictions. Therefore this systematic uncertainty is
applied as a shape effect only and an additional nuisance parameter is
introduced to cover the migration between analysis regions. As will be explained
in section~\ref{sec:zjets-shapes} it is necessary to de-correlate the $m_{bb}$
shape systematic in the lowest $p_T^V$ bin of the analysis. It is therefore the
case that the nuisance parameter controlling the migration between analysis
regions in the $m_{bb}$ variable is also de-correlated in that bin. These
acceptance uncertainties are applied to the CR$_{\text{high}}$ and
CR$_{\text{low}}$ separately, the nuisance parameters involved are
\texttt{SysZbbCRSRExtrapolation\_CRLow}, de-correlated as
\texttt{SysZbbCRSRextrap\_BMin75\_L2\_CRLow} and
\texttt{SysZbbCRSRExtrapolation\_CRHigh} de-correlated as
\texttt{SysZbbCRSRextrap\_BMin75\_L2\_CRHigh}. The determination of the prior
for these nuisance parameters is dominated by the difference between
\textsc{Sherpa}~2.2.1 and \textsc{MadGraph}.

\subsubsection{Flavour Composition Uncertainties}

The Z + hf process breaks down in the exact same way as the W + hf process, into
$(b,b)$, $(b, c)$, $(b, l)$ and $(c, c)$ sub-components. Uncertainties on the
fraction that each of these makes up of the Z + hf process are found in
table~\ref{tab:zjets-flavour-comp}.
\input{07-systematic-errors/zjets-flavour-comp}
They are calculated using equation~\ref{eq:acceptance-dr} and applied to the
non-$(b, b)$ component of the ratio. The nuisance parameters entering into the
fit are \texttt{SysZbcZbbRatio}, \texttt{SysZccZbbRatio} and
\texttt{SysZblZbbRatio}. Priors are calculated separately in the 0-- and
2--lepton channels, and in the 2--lepton channel priors are also calculated
separately in the 2-- and 3--jet categories. The variations are nonetheless
considered to be correlated across regions. The value of the priors is
completely dominated by the difference between the nominal \textsc{Sherpa}~2.2.1
prediction and the alternative \textsc{MadGraph} prediction.

\subsubsection{Shape Uncertainties}
\label{sec:zjets-shapes}

The shape uncertainties for the Z + jets process are derived using the
1--dimensional parametrisation approach detailed in
section~\ref{sec:1D-reweight} with one notable difference. Instead of a ratio of
predictions generated with different parameters, the ratio in this case is of
the nominal \textsc{Sherpa}~2.2.1 prediction and the data itself. In order to be
valid this method has a number of requirements, the first of which is that the
region of interest must have a high purity of the background for which the
uncertainty is derived. In the case of the 2--lepton channel the sidebands of
the region which contains both the VH(bb) signal and the VZ(bb) process is quite
pure in Z + jets events. The purity can be enhanced by subtracting from the data
the top quark background events which contribute second to the Z + jets events,
this can be done with a high degree of certainty over the template as the data
from the top $e\mu$ CR can be used. The remaining backgrounds contribute a very
small amount to the region and so even with large uncertainties on their
template the method is still sufficiently accurate.

This method is used to derived shape uncertainties on the $p_T^V$ and $m_{bb}$
variables as they are considered to be the most important in the analysis. The
uncertainty is used in the 0--lepton channel which adds an additional
complication. As mentioned in section~\ref{sec:2lep-selection} a kinematic fit
is used in order to correct the b-jet momentum and these corrected jets are then
used in the formulation of $m_{bb}$ in the 2--lepton channel only (as there are
two visible leptons). This means that $m_{bb}$ in the 0-- and 2--lepton channels
refers to a different quantity and so a shape uncertainty derived on one may not
be suitable to use on the other. In order to get around this issue the shape
uncertainty for $m_{bb}$ is derived on a variable that is calculated using
globally sequentially e
calibrated (GSC) jets and is called GSC $m_{bb}$, these jets have not undergone
the kinematic fit procedure and so ought to match more closely between the two
leptonic channels. In order for the region where this method is applied to not
contain signal events, or events from the diboson cross-check, events with
80~\GeV < GSC $m_{bb}$ < 140~\GeV are removed from all distributions considered.

The plots in figures~\ref{fig:zjets-ptv-shapes} and~\ref{fig:zjets-mbb-shapes}
show the nominal \textsc{Sherpa}~2.2.1 prediction of the Z + jets background in
the 2--lepton channel in the sum of analysis regions CR$_{\text{low}}$, SR and
CR$_{\text{high}}$ plotted against the subtracted data in the $p_T^V$ and GSC
$m_{bb}$ variables respectively.
\input{07-systematic-errors/zjets-mbb-shape-plots}
\input{07-systematic-errors/zjets-ptv-shape-plots}
The subtracted data is the data with a template comprised of the data from the
top $e\mu$ CR and the nominal predictions of all backgrounds other than Z + jets
subtracted from it. Plots are shown in the 2--jet, $\geq$3--jet and $\geq$2--jet
categories (the sum of the two jet multiplicity based categories in the
analysis) and are plotted across all $p_T^V$ bins of the analysis. The shape
uncertainty is derived by taking a fit to the ratio in the bottom pane of each
plot, the fit defines the 1-$\sigma$ up variation of the Gaussian constrained
nuisance parameter, the symmetrised version of the fit (not displayed) defines
the 1-$\sigma$ down variation. The $\geq$2--jet region is used to calculate the
prior for the systematic uncertainties \texttt{SysZPtV} and \texttt{SysZMbb}
that are applied to all Z + jets events in the 0-- and 2--lepton channels.

The nuisance parameters are correlated across leptonic channels, however as can
be seen by inspection of figure~\ref{fig:zjets-mbb-shapes} the fitted shape does
not cover the discrepancy between the subtracted data and the prediction at low
values of $m_{bb}$. Investigating the plots in
figure~\ref{fig:zjets-mbb-shape-ptv-range} shows that this discrepancy is coming
from the $75~\GeV < p_T^V < 150~\GeV$ analysis bin, therefore the aforementioned
nuisance parameters are decorrelated in this bin.
\input{07-systematic-errors/zjets-mbb-shapes-ptv-range}
The decorrelated parameters are named \texttt{SysZPtV\_BMin75\_L2} and
\texttt{SysMbb\_BMin75\_L2}. A summary of the Z + jets shape uncertainties is
found in table~\ref{tab:zjets-shapes}.
\input{07-systematic-errors/zjets-shape-table}

- Shapes derived in CR$_{\text{high}}$ + SR + CR$_{\text{low}}$.
- List of subtracted backgrounds
- What happens to pTV shape when you remove mbb window
- Specifically mention the fit functional form, binning choice, etc. 

\section{Systematic Uncertainties on \texorpdfstring{$t\bar{t}$}{tt} Events}

Modelling of $t\bar{t}$ events differs between the leptonic channels of the
analysis. Like many of the differences between channels that have been discussed
already the reason for this ultimately boils down to there being two visible
charged leptons in the final state of the 2--lepton channel, which come from the
vector boson. Using these charged leptons two regions can be defined in the
2--lepton channel, the same flavour region which breaks down into the usual
CR$_{\text{low}}$, SR and CR$_{\text{high}}$ and the opposite flavour region
known as the top $e\mu$ control region. These regions can be used to get a data
driven estimate of the background from top quark processes in the 2--lepton
channel, described in section~\ref{sec:ttbar_DD} but as they don't exist in the
0-- and 1--lepton channel Monte-Carlo generator predictions and theoretical
uncertainties are used instead. A summary of the nuisance parameters the control
the $t\bar{t}$ systematic uncertainties can be found in
table~\ref{tab:ttbar-systs}.
\input{07-systematic-errors/ttbar-table.tex}

The nominal Monte-Carlo prediction for the $t\bar{t}$ process is
\textsc{Powheg}~+~\textsc{Pythia}~8 with the \textsc{Powheg} NLO matrix element
(ME) generator~\cite{JHEP0709.2007.126,JHEP0411.2004.040} interfaced to
\textsc{Pythia}~8~\cite{Comp.Phys.Comm.191.159} using the A14
tune~\cite{ATL-PHYS-PUB-2014-021} to model parton showering, hadronisation,
the underlying event, and multiple parton interactions. The NNPDF3.0 (NLO) and
NNPDF2.3 parton distribution function sets are used in the ME calculation and
parton showering respectively~\cite{ATL-PHYS-PUB-2016-020}.

Details of the samples making up the nominal $t\bar{t}$ prediction can be found
in table~\ref{tab:ttbar-nominal} these include the high and low radiation
variations called  RadHi and RadLo respectively, the samples making up the
alternative prediction can be found in table~\ref{tab:ttbar-alternative}.

The $t\bar{t}$ cross section relevant to this analysis is calculated for
proton-proton collisions at a centre of mass energy of $\sqrt{s} = 13$~\TeV and
using a top quark mass of 172.5~\GeV is $831.76^{+40}_{-46}$\picobarn. The
calculation is  at next-to-next-to leading order in QCD including re-summation
of next-to-next-to-leading logarithmic (NNLL) soft gluon terms with
\textsc{top++2.0}~\cite{Beneke2012695,Cacciari2012612,PhysRevLett.109.132001,NNLOcorr,NNLOcorrNLO,PhysRevLett.110.252004,Czakon:2011xx}.
The PDF and $\alpha_S$ uncertainties are calculated using the PDF4LHC
prescription ~\cite{Botje:2011sn} with the MSTW2008~68\% CL
NNLO~\cite{PDFLHC,alphasunc}, CT10
NNLO~\cite{PhysRevD.82.074024,PhysRevD.89.033009} and NNPDF2.3 5f
FFN~\cite{Ball:2012cx} PDF sets, added in quadrature to the scale uncertainty.
PDFs uncertainties alone correspond to an error of $\pm 35.06$~\picobarn, while
the $\alpha_s$ variations correspond to an error of
$^{+19.77}_{-29.20}$~\picobarn.


% \subsection{Alternative Samples}
% \label{subsubsec:ttbarAlternative}
% Alternative $t\bar{t}$ MC generator configurations are used to assess the
% theoretical uncertainties on the top-quark pair production process for the
% 0-/1-lepton channel, by serving as point of comparison to the default MC
% configuration; referred to as a 2-point MC-to-MC systematic from here on. Table
% \ref{tabular:ttbarAlternativeSamples} summarised the different MC samples
% generated, which includes a short description of the main differences with
% respect to the nominal \POWHEG+\PYTHIA8 prediction. All the alternative samples
% are generated applying the same lepton filters as the default \POWHEG+\PYTHIA8
% sample. The samples considered are the following:


% \begin{itemize}
%         \item \textbf{\POWHEG+\HERWIG7 - Parton Shower}: Using the same setup
%           for \POWHEG as for the nominal \POWHEG+\PYTHIA8 sample, the parton
%           shower (PS), hadronisation, underlying event (UE) and multiple parton
%           interactions (MPI) are simulated with \HERWIG7.0
%           ~\cite{herwig271,EPJC.76.196} with the H7UE tune~\cite{EPJC.76.196}
%           tune. The primary purpose of this sample is to systematically vary the
%           parton shower model (\HERWIG7 vs \PYTHIA8) with respect to the nominal
%           prediction, while maintaining the same hard scattering simulation with
%           \POWHEG.
          
%         \item \textbf{\MADGRAPH5\_aMC@NLO+\PYTHIA8.2 - ME}: Using
%           \MADGRAPH5\_aMC@NLO~\cite{Alwall:2014hca} for the hard scattering
%           generation at NLO precision and \PYTHIA8.2 for the PS, hadronisation,
%           UE and MPI simulation, this sample serves as a systematic variation of
%           the matrix element (ME) or hard scattering calculation generation
%           (\MADGRAPH5\_aMC@NLO vs \POWHEG), while maintaining the same parton
%           shower model with \PYTHIA8.2.
          
%         \item \textbf{\POWHEG+\PYTHIA8 - Initial/Final State Radiation} Two
%           samples are produced with exactly the same setup as the nominal
%           \POWHEG+\PYTHIA8 samples, with the following exception:
          
%         \begin{list}{-}{}
%                 \item Low radiation sample: both renormalisation scale $\mu_R$
%                   and factorisation scale $\mu_F$ are doubled, the
%                   \POWHEG+\PYTHIA8 parameters are kept at their nominal values,
%                   \texttt{hdamp} $= 1.5 \cdot m_{top}$, \texttt{pTdef}$=2$ and
%                   \texttt{pThard}$=0$, while the the A14 tune (Var3c) Down
%                   variation is used (\textit{radLo}).
                  
%                 \item High radiation sample: both renormalisation scale $\mu_R$
%                   and factorization scale $\mu_F$ are halved, the
%                   \POWHEG+\PYTHIA8 parameters are kept at their nominal values,
%                   \texttt{pTdef}$=2$ and \texttt{pThard}$=0$ except
%                   \texttt{hdamp} set to $3.0 \cdot m_{top}$, and the A14 tune
%                   (Var3c) Up variation is used (\textit{radHi}).
                  
%         \end{list}
% \end{itemize}

% It should be noted that the \texttt{hdamp} parameter used to assess the low/high
% radiation systematics in \POWHEG corresponds to the transverse momentum scale
% around which the Sudakov resummation becomes insignificant, i.e. can be damped
% (the pure NLO matrix element provides a good description in these regions),
% meaning that smaller values of \texttt{hdamp} correspond to a larger suppression
% of the hardest emission from the matrix element to the cross section. This
% parameter is set to a finite value for the $t\bar{t}$ \POWHEG samples to avoid
% an underestimate of the scale dependence in the high-$p_T$ region. Therefore the
% $\mu_R$ and $\mu_F$ scales variations and \texttt{hdamp} variations are kept
% correlated since the two proposed variations envelope the full set of
% uncertainties obtained by changing the scales and the resummation damping
% parameter independently.




% The systematic model used in evaluating the MC based modelling uncertainties on
% the nominal $t\bar{t}$ prediction originates from the structure of the Profile
% Likelihood Fit, specifically there are three main components considered:


% \begin{itemize}
%   \item \textbf{Normalisation:} The overall normalisation of the background
%     across the entire fiducial phase space (all fit regions) is left freely
%     floating in 2-jet and 3-jet categories independently and being
%     multiplicative factors in the likelihood definition, require no prior
%     estimate (see details in Ref~\cite{Wang:2121287}).
    
%   \item \textbf{Acceptance:} Variation in acceptance between the different
%     analysis fit regions. Gaussian constrained nuisance parameters in the
%     Profile Likelihood Fit are assigned to control the relative yield
%     (acceptance) between the analysis fit regions. The Gaussian priors are
%     calculated as double ratios:
    
% \begin{equation}
% \label{equ:doubleratio}
% \left. \dfrac{Acceptance[Category_{A}(nominal MC)]}{Acceptance[Category_{B}(nominal MC)]} \middle/ \dfrac{Acceptance[Category_{A}(alternative MC)]}{Acceptance[Category_{B}(alternative MC)]} \right.
% \end{equation}


% This double ratio is calculated for several alternative MC samples normalised to
% the same NNLO cross-section, therefore no effect of changes in the total
% cross-section from the different MC schemes enters this calculation. The final
% uncertainties are given by the sum in quadrature of the three main variations:
% parton shower uncertainty (\POWHEG+\HERWIG7 versus \POWHEG+\PYTHIA8), matrix
% element uncertainty (\MADGRAPH5\_aMC@NLO+\PYTHIA8 versue \POWHEG+\PYTHIA8) and
% radiation uncertainties. For the latter case, half the difference between the
% \POWHEG+\PYTHIA8 with different radiation samples was taken into account in the
% sum in quadrature.


% Additional acceptance uncertainties come from the migration induced by the \ptv\
% and the BDTr-based shape uncertainties. The full breakdown of the normalization
% effect induced by these two systematics across all the analysis regions and
% across all the analysis regions and \ptv\ bins of the analysis are reported in
% Table~\ref{tab:ttbar_extrapolation_uncertainties_pTV} and
% Table~\ref{tab:ttbar_extrapolation_uncertainties_BDTr}.


% \item \textbf{Differential Shape Uncertainties:} as already explained in
%   Section~\ref{subsec:ShapeMethod}, a hybrid BDTr approach is used to derive the
%   shape uncertainties in both the 0-lepton and 1-lepton channels. Prior to the
%   training, the nominal \POWHEG+\PYTHIA8 events are reweighted by the ratio of
%   the nominal \POWHEG+\PYTHIA8 and the alternative \MADGRAPH5\_aMC@NLO+\PYTHIA8
%   and \POWHEG+\HERWIG7 generators in each jet category and flavour composition
%   (bb, bc and others events). These events are than used to train two different
%   BDTs to separate them from the alternative \MADGRAPH5\_aMC@NLO+\PYTHIA8 and
%   \POWHEG+\HERWIG7 events. The ratio between the nominal and each alternative
%   BDT score is than used as a reweighting factor. \\

 
% As the BDTr-based shape systematic does not account for the variance in \ptv\ ,
% a fit to the ratio between the nominal \POWHEG+\PYTHIA8 and the alternatives
% \MADGRAPH5\_aMC@NLO+\PYTHIA8 and \POWHEG+\HERWIG7 in each jet category and
% inclusively in the flavour categoris, is derived. Only the largest variation,
% coming from the comparison between \POWHEG+\PYTHIA8 and
% \MADGRAPH5\_aMC@NLO+\PYTHIA8, is considered as a \ptv\ shape systematic. A
% detailed description of the procedure used to derive both the \ptv  and
% BDT-based shape systematics is reported in
% Subsection~\ref{subsubsec:ttbar_shapesysts}.


%  \end{itemize}

% \subsubsection{Acceptance uncertainties}

% To control the correlations and model the extrapolation uncertainties on the
% overall $t\bar{t}$ floating normalisation (\texttt{norm\_ttbar}) across the
% different analysis fit regions, the following nuisance parameters are
% introduced:

% \begin{list}{-}{}
%         \item \textbf{[$CR_{low}, SR, CR_{high}$] ttbar Migration:} an
%           uncertainty on the relative $t\bar{t}$ event yield across the control
%           and signal regions. Covered by the $t\bar{t}$ \ptv shape uncertainty
%           and $p^{V}_{T}$ factorised BDTr uncertainty.
          
%         \item \textbf{$p^{V}_{T}$ ttbar Region Migrations:} an uncertainty on
%           the relative acceptance between the various binned $p^{V}_{T}$ fit
%           regions of the analysis. Covered by an uncertainty on the
%           $t\bar{t}~p^{V}_{T}$ spectrum.
          
%         \item \textbf{1-to-0-lepton uncertainty (0-/1-lepton):} 2+3-jet regions
%           in 1-lepton channel to the 2+3-jet regions in the 0-lepton channel
%           ($\texttt{SysTTbarNorm\_L0}$).
          
% \end{list}

% An overview of the $t\bar{t}$ normalisation/acceptance systematic priors, paired
% with the effect of each in the various analysis regions is detailed in
% Table~\ref{tab:ttbarSysSummary1} for the 0-/1-lepton channels. Further details
% concerning the full normalisation/acceptances amongst the analysis regions for
% the full MC prescription outlined above can be found in
% Appendix~\ref{app:ttbar}.


% \begin{table}[!htpb] 
% \begin{center} 
% \small
% \resizebox{\textwidth}{!}{%
% \begin{tabular}{  c  ||  c  c  c  c  c  c  } 
% \hline 
% \hline 
%             &     $\textrm{CR}_{\textrm{low}}$ 2j   &   SR 2j   &     $\textrm{CR}_{\textrm{high}}$ 2j    &    $\textrm{CR}_{\textrm{low}}$ 3j    &    SR 3j   &    $\textrm{CR}_{\textrm{high}}$ 3j \\
%             &     \multicolumn{6}{ c }{0-/1-lepton}    \\ 
% \hline 
% $\texttt{norm\_ttbar}$   &  \multicolumn{3}{ c }{Floating normalisation}  &  \multicolumn{3}{ c }{Floating normalisation} \\
% \hline \hline
%             &     \multicolumn{6}{ c }{1-lepton}    \\ 
% \hline
% \texttt{SysBDTr\_ttbar\_ME} &   \multicolumn{6}{ c }{CRLow/SR/CRHigh and $p^{V}_{T}$ region migrations covered by BDTr ME based shape systematic} \\
% \texttt{SysBDTr\_ttbar\_PS} &   \multicolumn{6}{ c }{CRLow/SR/CRHigh and $p^{V}_{T}$ region migrations covered by BDTr PS based shape systematic} \\
% \texttt{SysTTbarPTV\_BDTr}  &   \multicolumn{6}{ c }{$p_{T}^{V}$ dependent migrations covered by factorised BDTr $p_{T}^{V}$ shape systematic} \\
% \hline \hline
%             &     \multicolumn{6}{ c }{0-lepton}    \\
% \hline
% \texttt{SysTTbarNorm\_L0}   &     \multicolumn{6}{ c }{8\%}    \\
% \texttt{SysBDTr\_ttbar\_ME} &   \multicolumn{6}{ c }{CRLow/SR/CRHigh and $p^{V}_{T}$ region migrations covered by BDTr ME based shape systematic} \\
% \texttt{SysBDTr\_ttbar\_PS} &   \multicolumn{6}{ c }{CRLow/SR/CRHigh and $p^{V}_{T}$ region migrations covered by BDTr PS based shape systematic} \\
% \texttt{SysTTbarPTV\_BDTr} &   \multicolumn{6}{ c }{$p_{T}^{V}$ dependent migrations covered by factorised factorised $p_{T}^{V}$ shape systematic} \\
% \hline 
% \hline 
% \end{tabular}
% }
% \caption{ \label{tab:ttbarSysSummary1} Normalisation and acceptance priors
%   assiged to \ttbar\ process in the 0-/1-lepton analysis fit regions region.}
% \end{center} 
% \end{table} 

% \subsubsection{ Flavour Composition uncertainty}

% The $t\bar{t}$ background process, like the $V$+jets background, can be broken
% down into 6 flavour categories, [$bb,bc,bl,cc,cl,ll$]. However, with a $t \to
% Wb$ branching fraction of $0.957\pm0.034$ \cite{PhysRevD.98.030001}, an Anti-kT
% EMTopo $R=0.4$ jet $b$-tagging efficiency of 70\%, and the leading
% miss-classification rate of 12.5\% for charm-jets, only the $[bb,bc]$ flavour
% components are non-negligible. Therefore, the $t\bar{t}$ background process is
% categorised according to a reduced set of flavour categorises, [$bb,bc,$Oth],
% where Oth = [$bl,cc,cl,ll$].


% To account for any systematic uncertainty in the flavour composition of the
% $t\bar{t}$ process stemming from MC modelling, flavour composition uncertainties
% are applied on the relative fraction of $bc$ to $bb$ and Oth to $bb$. Estimated
% using the same uncertainty prescription as summarised in Section
% \ref{subsubsec:ttbarAlternative}, Table \ref{tab:TTbarFlavPriors} summarises the
% flavour fraction uncertainty priors originating from the ME and PS comparisons
% as a function of the jet category for the 0-lepton and 1-lepton channels. Each
% column is constructed according to:


% \begin{equation}

% \sigma_{\textrm{flav}} = \frac{ N^{XY}_{0}}{N^{bb}_{0}}/\frac{N^{XY}_{v}}{N^{bb}_{v}},
% \label{eq:TTbarFlavFormula}
% \end{equation}
% where $N^{bb}$ represents $bb$ categorised event yield, $N^{XY}$ is the
% $[bc,\textrm{Oth}]$ event yield, subscript $v$ represents the alternative MC
% configurations, and subscript $0$ represents the nominal MC configuration
% \POWHEG+\PYTHIA8.

                                                                                                                                                                                  
% \begin{table}
%   \begin{center}
%     \vspace{5mm}
%     %\resizebox{\linewidth}{!}{                                                                                                                                                                             
%       \begin{tabular}{l|l||c|c|c|c}
%         \hline
%         \hline
%         \multirow{2}{*}{\textbf{Nuisance parameter}} & \multirow{2}{*}{\textbf{Systematic}} & \multicolumn{2}{c|}{\textbf{2-jet}} & \multicolumn{2}{c}{\textbf{3-jet}} \\
%         &   & \textbf{bc} & \textbf{Oth} & \textbf{bc} & \textbf{Oth} \\
%         \hline
%         \hline
%         &        & \multicolumn{4}{c}{\textbf{0-lepton}} \\
%         \hline
%         \texttt{SysTTbarbcMEACC}  &  \multirow{2}{*}{Matrix Element} & $+8.2$\% & -- & $+7.6$\% & -- \\
%         \texttt{SysTTbarOthMEACC} &                                  & -- & $-6.36$\% & -- & $-2.8$\% \\
%         \hline
%         \texttt{SysTTbarbcPSACC}  &  \multirow{2}{*}{Parton Shower}  & $-2.1$\% & -- & $-3.2$\% & -- \\
%         \texttt{SysTTbarOthPSACC} &                                  & -- & $-13.2$\% & -- & $-5.6$\% \\
%         \hline
%         %        \textbf{Total} & $\pm 8.5$\% & $\pm 14.7$\% & $\pm 8.2$\% & $\pm 6.3$\% \\
%         \hline
%         &        & \multicolumn{4}{c}{\textbf{1-lepton}} \\
%         \hline
%         \texttt{SysTTbarbcMEACC}  &  \multirow{2}{*}{Matrix Element} & $+1.3$\% & -- & $+3.8$\% & -- \\
%         \texttt{SysTTbarOthMEACC} &   & -- & $+3.3$\% & -- & $+5.7$\% \\
%         \hline                    
%         \texttt{SysTTbarbcPSACC}  &  \multirow{2}{*}{Parton Shower}  & $+7.1$\% & -- & $+1.5$\% & -- \\
%         \texttt{SysTTbarOthPSACC} &   & -- & $+0.3$\% & -- & $+2.1$\% \\  
%         \hline
%         %\textbf{Total} & $\pm 7.2$\% & $\pm 3.3$\% & $\pm 4.1$\% & $\pm 6.1$\% \\
%         \hline
%       \end{tabular}
%     %}%
%     \caption{ Summary of flavour composition uncertainties for each jet category
%       in the 0-lepton and 1-lepton channels for the relative variation of the
%       $bc$/Oth event flavours relative to the dominant $bb$ flavour conponents.
%       Note that the numbers quoted are caluclated using $\alpha =
%       \sigma_{\textrm{flav}} - 1 $, where $\sigma_{\textrm{flav}}$ is given by
%       eq. \ref{eq:TTbarFlavFormula}.}\label{tab:TTbarFlavPriors}
    
%   \end{center}
% \end{table}

% These priors are included in the profile likelihood fit as four guassian
% constrained nuisance parameters, one for each jet category and each MC
% variation, for both the 0-lepton and 1-lepton channels. The names of these
% nuisance parameters can be found in the first column of Table
% \ref{tab:TTbarFlavPriors}.



% \subsubsection{BDTr-based shape uncertainties}
% \label{subsubsec:ttbar_shapesysts}

% A hybrid BDT-reweighting approach, as described in
% Section~\ref{subsec:ShapeMethod}, has been adopted in the 1-lepton and the
% 0-lepton channels to derive the BDT-based shape systematics. The reason for this
% is described in Section~\ref{subsec:ShapeMethod}.\\


% \textbf{\ptv\ shape systematic}
% \label{subsubsec:ttbar_1D_shape_Uncert}

% In each leptonic channel and for each Monte Carlo prediction
% (\MADGRAPH5\_aMC@NLO+\PYTHIA8 and \POWHEG+\HERWIG7),  six shapes are derived
% depending on the jet category (2-jet and 3-jet) and flavour composition of the
% event (bb, bc, others = bl, cc, cl, ll). \\

% In the 1-lepton channel, these shapes are obtained from a second order
% polinomial fit to the ratio between the nominal \POWHEG+\PYTHIA8 and the
% alternatives \MADGRAPH5\_aMC@NLO+\PYTHIA8 and \POWHEG+\HERWIG7 in the \ptv\
% distribution with $p_T^V > 75$\ GeV. In the 0-lepton channel, the MET
% distribution with MET $>150$\ GeV is used.\\

% Only the largest variation is taken in both the 0-lepton and 1-lepton channels
% and this is coming from the comparison between \POWHEG+\PYTHIA8 and the
% alternatives \MADGRAPH5\_aMC@NLO+\PYTHIA8 in both 2-jet and 3-jet categories.


% Figure~\ref{fig:ttbar_1lep_SysTTbarPTVBDTr} shows the \ptv\ shape systematics in
% the 1-lepton channel for all flavour categories combined (bb, bc, oth.) and for
% 2-jet and 3-jet events, respectively. The \ptv\ shape is derived from a fit to
% the ratio between the nominal \POWHEG+\PYTHIA8 and the alternative
% \MADGRAPH5\_aMC@NLO+\PYTHIA8.


% \begin{figure}[H]
% \begin{center}
% \subfigure[$p_T^V$ 2tag 2jet]{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/1Lep_pTVreweighting_shapes/ttbar_1Lep_2tag2jet_75ptv_pTV.pdf}}
% \subfigure[$p_T^V$ 2tag 3jet]{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/1Lep_pTVreweighting_shapes/ttbar_1Lep_2tag3jet_75ptv_pTV.pdf}}\\
% \caption{\ptv\ shape systematic in the 1-lepton channel for all flavour
%   categories combined (bb, bc and oth.) and for 2-jet and 3-jet categories. The
%   \ptv\ distribution is shown in blue for \POWHEG+\PYTHIA8, in red for
%   \MADGRAPH5\_aMC@NLO+\PYTHIA8 and in green for \POWHEG+\HERWIG7. The \ptv\
%   shape is derived from a fit to the ratio between \POWHEG+\PYTHIA8 and
%   \MADGRAPH5\_aMC@NLO+\PYTHIA8 and is plotted in black. }

% \label{fig:ttbar_1lep_SysTTbarPTVBDTr}
% \end{center}
% \end{figure}

% Figure~\ref{fig:ttbar_0lep_SysTTbarPTVBDTr} shows the MET shape systematics in
% the 0-lepton channel for all flavour categories combined (bb, bc, oth.) and for
% 2-jet and 3-jet events, respectively. The MET shape is derived from a fit to the
% ratio between the nominal \POWHEG+\PYTHIA8 and the alternative
% \MADGRAPH5\_aMC@NLO+\PYTHIA8.



% \begin{figure}[H]
% \begin{center}
% \subfigure[MET 2tag 2jet]{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/0Lep_METreweighting_shapes/ttbar_0Lep_2tag2jet_150ptv_MET.pdf}}
% \subfigure[MET 2tag 3jet]{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/0Lep_METreweighting_shapes/ttbar_0Lep_2tag3jet_150ptv_MET.pdf}}\\
% \caption{MET shape systematic in the 0-lepton channel for all flavour categories
%   combined (bb, bc and oth.) and for the 2-jet and 3-jet categories. The MET
%   distribution is shown in blue for \POWHEG+\PYTHIA8, in red for
%   \MADGRAPH5\_aMC@NLO+\PYTHIA8 and green for \POWHEG+\HERWIG7. The MET shape is
%   derived from a fit to the ratio between \POWHEG+\PYTHIA8 and
%   \MADGRAPH5\_aMC@NLO+\PYTHIA8 and is plotted in black. }

% \label{fig:ttbar_0lep_SysTTbarPTVBDTr}
% \end{center}
% \end{figure}


% \textbf{BDTr shape systematic}

% Prior to the training, the nominal \POWHEG+\PYTHIA8 events are reweighted by the
% \ptv\ and MET shape uncertainties calculated in the Section
% \ref{subsubsec:ttbar_1D_shape_Uncert}, for the 1-lepton and 0-lepton channels
% respectively. The \ptv/MET shape uncertainties are derived for the $bb$, $bc$,
% and $[bl,cc,cl,ll]$ flavour categories, divided further according to the jet
% category. This thereby decouples the $p^{V}_{T}$/MET shape uncertainty from the
% BDTr shape systematic.\\


% Following the factorisation of the \ptv/MET information, the \ptv weighted
% \POWHEG+\PYTHIA8 and alternative $t\bar{t}$ samples are then trained against
% each other using a classification BDT. The input variables for each BDT training
% match exactly those variables used in the main analysis MVA (as outlined in Ref.
% \cite{AlKhoury:2692011}). Upon completion of the training and evaluation of the
% BDT classifier for each jet category and the aforementioned flavour categories,
% the density ratio between the nominal and alternative BDT distributions is
% derived. This is then implemented as either a binned or continuous parameteric
% re-weighting function within the analysis, which then enter the profile
% likelihood fit as a set of nuisance parameters called
% \texttt{SysBDTr\_ttbar\_ME} and \texttt{SysBDTr\_ttbar\_PS}.


% In Figure~\ref{fig:ttbar_1lep_2jet_BDTrClosure_PS_1} the closure of the
% BDTr-based shape systematic for the comparison between \POWHEG+\PYTHIA8 and
% \POWHEG+\HERWIG7 is shown for some of the key variables entering the analysis
% MVA for the 1-lepton 2tag2jet category and for the $t\bar{t}$-bb events only.
% More plots showing the closure of the remaining flavour pairs in the 1-lepton
% 2tag2jet category and the full set of plots for the 1-lepton 2tag3jet category
% can be found in the Appendix~\ref{app:ttbar}. Good closure is observed in
% general and, in most of the cases, the BDTr-based shape systematic allows to
% smooth away the statistical fluctuations.


% \begin{figure}[H]
% \begin{center}
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/1Lep_BDTbased_closure/PS_pTV_2jet_bb.pdf}}
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/1Lep_BDTbased_closure/PS_mBB_2jet_bb.pdf}}  \\
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/1Lep_BDTbased_closure/PS_mTop_2jet_bb.pdf}}
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/1Lep_BDTbased_closure/PS_dRBB_2jet_bb.pdf}}
% \caption{Closure of the BDTr-based systematic derived from the comparison
%   between \POWHEG+\PYTHIA8 and \POWHEG+\HERWIG7 on the variables entering the
%   analysis MVA in the 2tag2jet region of the 1-lepton channel. The BDTr-based
%   systematic is plotted in green while the \ptv\ shape systematic is plotted in
%   magenta. By definition, the magenta distribution, which represents the nominal
%   \POWHEG+\PYTHIA8 reweighted by the ratio (histogram) with the alternative
%   \POWHEG+\HERWIG7, should match exactly the red one, which represents the
%   alternative \POWHEG+\HERWIG7. }

% \label{fig:ttbar_1lep_2jet_BDTrClosure_PS_1}
% \end{center}
% \end{figure}


% In Figure~\ref{fig:ttbar_1lep_2jet_BDTrClosure_ME_1} the closure of the
% BDTr-based shape systematic for the comparison between \POWHEG+\PYTHIA8 and
% \MADGRAPH5\_aMC@NLO+\PYTHIA8 is shown on some of the key variables entering the
% analysis MVA for the 1-lepton 2tag2jet category and for the $t\bar{t}$-bb events
% only. More plots showing the closure on the remaining flavour pairs in the
% 1-lepton 2tag2jet category and the full set of plots for the 1-lepton 2tag3jet
% category can be found in the Appendix~\ref{app:ttbar}. Good closure is observed
% in general and, in most of the cases, the BDTr-based shape systematic allows to
% smooth away the statistical fluctuations.



% \begin{figure}[H]
% \begin{center}
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/1Lep_BDTbased_closure/ME_pTV_2jet_bb.pdf}}
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/1Lep_BDTbased_closure/ME_mBB_2jet_bb.pdf}}  \\
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/1Lep_BDTbased_closure/ME_mTop_2jet_bb.pdf}}
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/1Lep_BDTbased_closure/ME_dRBB_2jet_bb.pdf}}
% \caption{Closure of the BDTr-based systematic derived from the comparison
%   between \POWHEG+\PYTHIA8 and \MADGRAPH5\_aMC@NLO+\PYTHIA8 on the variables
%   entering the analysis MVA in the 2tag2jet region of the 1-lepton channel. The
%   BDTr-based systematic is plotted in green while the \ptv\ shape systematic is
%   plotted in magenta. By definition, the magenta distribution, which represents
%   the nominal \POWHEG+\PYTHIA8 reweighted by the ratio (histogram)  with the
%   alternative \MADGRAPH5\_aMC@NLO+\PYTHIA8, should match exactly the red one,
%   which represents the alternative \MADGRAPH5\_aMC@NLO+\PYTHIA8.}

% \label{fig:ttbar_1lep_2jet_BDTrClosure_ME_1}
% \end{center}
% \end{figure}

% In Figure~\ref{fig:ttbar_0lep_2jet_BDTrClosure_PS_1} the closure of the
% BDTr-based shape systematic for the comparison between \POWHEG+\PYTHIA8 and
% \POWHEG+\HERWIG7 is shown on some of the key variables entering the analysis MVA
% for the 0-lepton 2tag2jet category and for the $t\bar{t}$-bb events only. More
% plots showing the closure on the remaining flavour pairs in the 0-lepton
% 2tag2jet category and the full set of plots for the 0-lepton 2tag3jet category
% can be found in the Appendix~\ref{app:ttbar}. Good closure is observed in
% general and, in most of the cases, the BDTr-based shape systematic allows to
% smooth away the statistical fluctuations.


% \begin{figure}[H]
% \begin{center}
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/0Lep_BDTbased_closure/PS_MET_2jet_bb.pdf}}
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/0Lep_BDTbased_closure/PS_mBB_2jet_bb.pdf}}  \\
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/0Lep_BDTbased_closure/PS_dRBB_2jet_bb.pdf}}
% \caption{Closure of the BDTr-based systematic derived from the comparison
%   between \POWHEG+\PYTHIA8 and \POWHEG+\HERWIG7 on the variables entering the
%   analysis MVA in the 2tag2jet region of the 0-lepton channel. The BDTr-based
%   systematic is plotted in green while the \ptv\ shape systematic is plotted in
%   magenta. By definition, the magenta distribution, which represents the nominal
%   \POWHEG+\PYTHIA8 reweighted by the ratio (histogram) with the alternative
%   \POWHEG+\HERWIG7, should match exactly the red one, which represents the
%   alternative \POWHEG+\HERWIG7. }

% \label{fig:ttbar_0lep_2jet_BDTrClosure_PS_1}
% \end{center}
% \end{figure}

% In Figure~\ref{fig:ttbar_0lep_2jet_BDTrClosure_ME_1} the closure of the
% BDTr-based shape systematic for the comparison between \POWHEG+\PYTHIA8 and
% \MADGRAPH5\_aMC@NLO+\PYTHIA8 is shown on some of the key variables entering the
% analysis MVA for the 0-lepton 2tag2jet category and for the $t\bar{t}$-bb events
% only. More plots showing the closure on the remaining flavour pairs in the
% 0-lepton 2tag2jet category and the full set of plots for the 0-lepton 2tag3jet
% category can be found in the Appendix~\ref{app:ttbar}. Good closure is observed
% in general and, in most of the cases, the BDTr-based shape systematic allows to
% smooth away the statistical fluctuations.


% \begin{figure}[H]
% \begin{center}
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/0Lep_BDTbased_closure/ME_MET_2jet_bb.pdf}}
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/0Lep_BDTbased_closure/ME_mBB_2jet_bb.pdf}}  \\
% \subfigure{\includegraphics[width=0.45\textwidth]{figures/ttbar/BDTreweighting/0Lep_BDTbased_closure/ME_dRBB_2jet_bb.pdf}}
% \caption{Closure of the BDTr-based systematic derived from the comparison
%   between \POWHEG+\PYTHIA8 and \MADGRAPH5\_aMC@NLO+\PYTHIA8 on the variables
%   entering the analysis MVA in the 2tag2jet region of the 0-lepton channel. The
%   BDTr-based systematic is plotted in green while the \ptv\ shape systematic is
%   plotted in magenta. By definition, the magenta distribution, which represents
%   the nominal \POWHEG+\PYTHIA8 reweighted by the ratio (histogram) with the
%   alternative \MADGRAPH5\_aMC@NLO+\PYTHIA8, should match exactly the red one,
%   which represents the alternative \MADGRAPH5\_aMC@NLO+\PYTHIA8.}

% \label{fig:ttbar_0lep_2jet_BDTrClosure_ME_1}
% \end{center}
% \end{figure}


% Table~\ref{tab:ttbar_extrapolation_uncertainties_pTV} and
% Table~\ref{tab:ttbar_extrapolation_uncertainties_BDTr} show the extrapolation
% uncertainties of the \ptv\ and the BDTr-based shape systematics\ptv\ and the
% BDTr-based shape systematics, respectively, across all regions and \ptv\ bins of
% the analysis for both the 0-lepton and the 1-lepton channels.

% \begin{table}[!htb]
% \begin{center}
% \tiny
% \begin{tabular}{ c || c | c | c | c | c | c  }
% \hline
% \multicolumn{7}{ c }{\textbf{0-lepton}}\\
% \hline
% \multicolumn{7}{ c }{2-jet}\\
% \hline
%                            & CR$_{low}$ &  SR   &  CR$_{high}$ & weighted-sum & weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\              & 1.59       & 0.89    & <0.5\%    & 0.52     &   \multirow{2}{*}{0.89}      &    \multirow{2}{*}{-1.89}       \\
% 250 \ptv\                  & -8.89      & -7.93   & -8.24     & -8.14    &         &           \\
% $\Delta$(high-low) \ptv\   & -10.48     & -8.82   & -8.24     & -8.66    & --   & --     \\
% \hline
% \multicolumn{7}{ c }{3-jet}\\
% \hline
%                            & CR$_{low}$ & SR      &  CR$_{high}$ & weighted-sum &  weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\              & 1.15         & 0.92      & <0.5\%    & 0.40         &  \multirow{2}{*}{0.37}       &    \multirow{2}{*}{-1.35}      \\
% 250 \ptv\                  & -9.42        & -9.57     & -9.71     & -9.68        &           &          \\ 
% $\Delta$(high-low) \ptv\   & -10.57       & -10.49    & -9.71     & -10.08       &  --      &     --  \\
% \hline
% \hline
% \multicolumn{7}{ c }{\textbf{1-lepton}}\\
% \hline
% \multicolumn{7}{ c }{2-jet}\\
% \hline
%        & CR$_{low}$ & SR &  CR$_{high}$ & weighted-sum &  weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\              & -4.36      & -4.72   & -5.26     & -5.02    &   \multirow{2}{*}{0.52}        &    \multirow{2}{*}{-0.92}      \\
% 250 \ptv\                  & -10.08     & -10.12  & -10.20    & -10.19   &           &          \\
% $\Delta$(high-low) \ptv\   & -5.72      & -5.40   & -4.94     & -5.17    &   --     &  --   \\
% \hline
% \multicolumn{7}{ c }{3-jet}\\
% \hline
% &  CR$_{low}$ & SR &  CR$_{high}$ & weighted-sum &     weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\              & -4.32       & -4.54     & -5.19        & -5.00      &  \multirow{2}{*}{0.35}      &      \multirow{2}{*}{-1.21}       \\
% 250 \ptv\                  & -10.82      & -10.85    & -10.99       & -10.98     &        &             \\
% $\Delta$(high-low) \ptv\   & -6.50       & -6.31     & -5.80        & -5.98      &   --      &     --       \\
% \hline
% \hline
% \end{tabular}
% \caption{Summary of the extrapolation uncertainties of the \ptv\ shape
%   systematic on the $t\bar{t}$ sample across all the analysis regions of the
%   analysis and in the 0 and 1-lepton channels. The third column for both 2-jet
%   and 3-jet categories shows the normalization effect induced by the shape
%   systematic weighted by the yields in each of the analysis regions. The last
%   row for both 0-lepton and 1-lepton channels shows the normalization effect
%   induced by the \ptv\ shape systematic across the different \ptv\ bins of the
%   analyisis. The last two columns show the migration effect, inclusive in the
%   two \ptv\ bins induced by the \ptv\ shape systematic from CR$_{low}$ to SR and
%   from CR$_{high}$ to SR.}

% \label{tab:ttbar_extrapolation_uncertainties_pTV}
% \end{center}
% \end{table}




% \begin{table}[!htb]
% \begin{center}
% \tiny
% \begin{tabular}{ c || c | c | c | c | c | c  }
% \hline
% \hline
% \multicolumn{7}{ c }{\textbf{0-lepton - \texttt{SysBDTr\_ttbar\_ME}}}\\
% \hline
% \multicolumn{7}{ c }{2-jet}\\
% \hline
%         & CR$_{low}$ & SR &  CR$_{high}$ & weighted-sum &   weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\              & -18.97  & -5.52  & -15.67  & -11.02  &  \multirow{2}{*}{-13.46}      &    \multirow{2}{*}{-9.25}   \\
% 250 \ptv\                  & -26.98  & -7.77  & -2.18   & -4.60   &        &         \\
% $\Delta$(high-low) \ptv\   & -8.01   & -2.25  & 13.49   & 6.42    &  --      &   --   \\
% \hline
% \multicolumn{7}{ c }{3-jet}\\
% \hline
%         & CR$_{low}$ & SR &  CR$_{high}$ & weighted-sum   &  weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\              & -4.91   & -4.96  & -4.76 & -4.84 &     \multirow{2}{*}{+0.11}      &    \multirow{2}{*}{+0.47}      \\
% 250 \ptv\                  & -12.89  & -11.60 & -4.08 & -5.72 &           &          \\
% $\Delta$(high-low) \ptv\   & -7.98   & -6.64  & -0.68 & -0.88 &     --      &   --  \\
% \hline
% \hline
% \multicolumn{7}{ c }{\textbf{0-lepton - \texttt{SysBDTr\_ttbar\_PS}}}\\
% \hline
% \multicolumn{7}{ c }{2-jet}\\
% \hline
%        & CR$_{low}$ & SR &  CR$_{high}$ & weighted-sum &    weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\              & -2.50   & -1.55  & -3.87   & -2.68   &    \multirow{2}{*}{-1.07}       &   \multirow{2}{*}{-1.79}      \\
% 250 \ptv\                  & -8.43   & <0.5\% & 5.84    & 3.49    &           &         \\
% $\Delta$(high-low) \ptv\   & -5.93   & 1.55   & 9.71    & 6.17    &    --       &     --    \\
% \hline
% \multicolumn{7}{ c }{3-jet}\\
% \hline
%        & CR$_{low}$ & SR &  CR$_{high}$ & weighted-sum &   weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\                & -1.52   & -2.41  & -4.91 & -3.81 &    \multirow{2}{*}{+0.81}       &   \multirow{2}{*}{-2.25}      \\ 
% 250 \ptv\                    & -3.94   & -1.45  & -1.43 & -1.47 &          &         \\
% $\Delta$(high-low) \ptv\     & -2.42   & 0.96   & 3.48  & 2.35  &    --       &   --      \\
% \hline
% \hline
% \multicolumn{7}{ c }{\textbf{1-lepton - \texttt{SysBDTr\_ttbar\_ME}}}\\
% \hline
% \multicolumn{7}{ c }{2-jet}\\
% \hline
%        & CR$_{low}$ & SR &  CR$_{high}$ & weighted-sum &   weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\              & 3.49    & 1.39   & -1.95   & -0.47   &   \multirow{2}{*}{+2.15}      &   \multirow{2}{*}{-3.29}      \\
% 250 \ptv\                  & 0.65    & -0.54  & -2.23   & -1.94   &         &         \\
% $\Delta$(high-low) \ptv\   & -2.84   & -1.93  & -0.28   & -1.47   &   --       &     --   \\
% \hline 
% \multicolumn{7}{ c }{3-jet}\\
% \hline
%   & CR$_{low}$ & SR &  CR$_{high}$ & weighted-sum    &  weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\                 & 2.40    & 0.97   & -1.69  & -0.88 &   \multirow{2}{*}{+1.48}    &   \multirow{2}{*}{-2.79}    \\
% 250 \ptv\                     & <0.5\%  & -1.30  & -3.00  & -2.82 &       &       \\
% $\Delta$(high-low) \ptv\      & -2.40   & -2.27  & -1.31  & -1.94 &   --       &    --   \\
% \hline
% \hline
% \multicolumn{7}{ c }{\textbf{1-lepton - \texttt{SysBDTr\_ttbar\_PS}}}\\
% \hline
% \multicolumn{7}{ c }{2-jet}\\
% \hline
%        & CR$_{low}$ & SR &  CR$_{high}$ & weighted-sum &   weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\              & -0.57   & -0.69  & <0.5\%  & -0.28   &   \multirow{2}{*}{+0.17}    &   \multirow{2}{*}{+0.92}      \\
% 250 \ptv\                  & -7.60   & -3.81  & 0.87    & 0.07    &       &         \\
% $\Delta$(high-low) \ptv\   & -7.03   & -3.12  & 0.87    & 0.35    &   --    &   --  \\
% \hline
% \multicolumn{7}{ c }{3-jet}\\
% \hline
%        & CR$_{low}$ & SR &  CR$_{high}$ & weighted-sum &   weighted-sum $\Delta$(CR$_{low}$ - SR)  & weighted-sum $\Delta$(CR$_{high}$ - SR)    \\
% \hline
% 150-250 \ptv\                 & 1.77    & <0.5\% & -0.57  & -0.35 &    \multirow{2}{*}{+1.74}    &   \multirow{2}{*}{-0.42}      \\
% 250 \ptv\                     & -1.69   & -1.37  & <0.5\% & -0.14 &        &         \\
% $\Delta$(high-low) \ptv\      & -3.46   & -1.37  & 0.57   & 0.21 &     --  &   --  \\
% \hline
% \hline
% \end{tabular}
% \caption{Summary of the extrapolation uncertainties of the BDTr-based shape
%   systematic on the $t\bar{t}$ samples across all the analysis regions of the
%   analysis and in the 0 and 1-lepton channels. The third column for both 2-jet
%   and 3-jet categories shows the normalization effect induced by the shape
%   systematic weighted by the yields in each of the analysis regions. The last
%   row for both 0-lepton and 1-lepton channels shows the normalization effect
%   induced by the BDTr-based shape systematic across the different \ptv\ bins of
%   the analyisis. The last two columns show the migration effect, inclusive in
%   the two \ptv\ bins induced by the \ptv\ shape systematic from CR$_{low}$ to SR
%   and from CR$_{high}$ to SR.}

% \label{tab:ttbar_extrapolation_uncertainties_BDTr}
% \end{center}
% \end{table}


% \makeatletter
% \def\ddtt@base{./}
% \def\ddtt@figures{figures/datadrivenTTbar}
% \def\ddtt@fig@scripts{\ddtt@base/TTbar_DataDrive_Tex}
% \def\ddtt@fig@angle{0}
% \def\ddtt@fig@anglepull{270}
% \input{\ddtt@fig@scripts/figure.tex}
% \input{\ddtt@fig@scripts/tables.tex}
% \makeatother

% \newcommand{\unit}[1]
% {{\, \mathrm{#1}}}

% \newcommand{\Hyphen}[0]
% {{\textrm \,\mathchar`-\,}}

% \newcommand{\emucr}[0]
% {${\textrm e\mu CR}$}


\subsection{Data Driven Estimation}
\label{sec:ttbar_DD}

% As one of the leading uncertainties in the \Vhtobb 2018 discovery
% \cite{VHmainsupportnote}, $t\bar{t}$ modeling uncertainties were a performance
% limiting factor within the analysis. Therefore in order to reduce the impact of
% top modelling, and increase the rebustness of the analysis, a data driven
% estimation of $t\bar{t}$ and single top background in the 2 lepton channel was
% adopted. Distributions of data as a function of an observable ($\mathcal{O}$) in
% the ${\textrm top\Hyphen e\mu}$ CRs (\emucr{}) can be directly used as a
% template for the top background ($t\bar{t}$ and single top) within the signal
% regions (SR), once a normalisation correction factor between the two regions is
% derived:

% \begin{align}
% N_{\textrm top, data}^{\textrm SR}
% =
% \frac{N_{\textrm top, data}^{\textrm CR}}{N_{\textrm top, MC}^{\textrm CR}}
% \times
% N_{\textrm top, MC}^{\textrm SR}
% =
% \frac{N_{\textrm top, MC}^{\textrm SR}}{N_{\textrm top, MC}^{\textrm CR}}
% \times
% N_{\textrm top, data}^{\textrm CR}.
% \label{eq:TTbar_DD_ExtrapFac}
% \end{align}
% Due to the very high purity of top background (99.5-99.9\% depending on the
% categories, see Ref. \cite{VHmainsupportnote}) in the \emucr{}s, the $N_{\textrm
%   top, data}^{\textrm CR}$ can be considered as the integral of the data in the
% \emucr{}.

% The extrapolation factor between the \emucr{} and SR (right hand side of
% equation \ref{eq:TTbar_DD_ExtrapFac}), ${N_{\textrm top, MC}^{\textrm
%     SR}}/{N_{\textrm top, MC}^{\textrm CR}}$ (the scale factor, $\alpha$), can
% then be estimated via studying Monte Carlo predictions.

% This is made possible due to the same kinematic selections that are applied to
% both SRs and \emucr{}s, and the flavor symmetric nature ofthe $t\bar{t}$ (and
% Wt) background, which means that most of the systematic uncertainties on the
% extrapolation parameter cancel; especially the theoretical modeling and
% jet-related systematic uncertainties. Therefore, the normalization and shape of
% flavor symmetric top background in the SRs can be estimated by using
% $\alpha\times N_{\textrm top, data}^{\textrm CR}$, and the differential shape of
% the data in the \emucr{} as a function of $\mathcal{O}$.


% In this data-driven background estimation, the two things are achieved:

% \begin{enumerate}
% \item[(i)]
  
% eliminating experimental systematics related to detector and combined
% performance, jet and flavor tagging.

% \item[(i)]
  
% eliminating theoretical systematics from modeling and MC dependence.
% \end{enumerate}
% Since the dominant systematic source of uncertainty in the data-driven
% estimation is the limited data statistics, statistical uncertainties in the
% \emucr{} data are implemented in the fit studies.


% As the the foundation of this method relies on the assumption that the shapes of
% the $t\bar{t}$ and single top background in the SR are the same as those in the
% \emucr{}, validation studies have been performed to show that the differential
% cross-sections of the top background agree within statistical uncertainty, when
% comparing the SR and \emucr{}, i.e. the $\alpha$ is not dependent on any
% kinematic variable (see Section \ref{ssec:comp2Lsrcr}). Furthermore, data/MC
% plots utilising this method are then shown in the Section \ref{ssec:datamcDD} as
% a check on the performance of the data-driven estimation to model the data in
% the SR.

% For further details concerning fit stability tests, and systematic shape
% cancelation effects between SR and \emucr, the reader is directed to Appendix
% \ref{app:FitTTbarDD}.

%  The reader should be aware that all studies/fits are done using the ICHEP 2018
%  style fit regions (as outlined in Ref. \cite{VHmainsupportnote}), and only
%  utilise the 2015-2017 datasets. However, as the $t\bar{t}$ data-driven
%  methodology utilises the same-flavour ($ee\mu\mu$) vs different-flavour
%  ($e\mu$) categorisation, it is independent of the definition of CR/SRs, so the
%  revised fit strategy in the new \Vhtobb analysis has little impact on the
%  studies presented here.
 

% \subsubsection{Comparison of distributions between SR and \emucr{}}
% \label{ssec:comp2Lsrcr}

% \tabCompSamples

% In this section, the $p^{Z}_{T}$, $n_{jet}$, $m_{bb}$, $\textrm{BDT}_{VH}$
% distributions in the 2 lepton SRs and \emucr{}s are compared using processes
% listed in Table \ref{tab:CompSamples}, in order to validate the assumption that
% the \emucr top data-driven estimate is kinematically identical to the SR top
% processes. To investigate the difference four categories are considered,
% $n_{jet} = [2,3]$ and $ p^{V}_{T} \geq 150\textrm{GeV}$, where the
% aforementioned kinematic variables are compared, see Figures \ref{fig:compptv}
% and \ref{fig:compnjet}.

% No significant kinematic dependence can be found in the ratio(=$\alpha$) for the
% \ptv{} plots (as shown in the bottom panes of each figure), so there is no need
% to split the scale factors for the medium and high \ptv{} categories. No global
% slopes in the ratio for the $n_{\textrm{jet}}$ plots, but the fluctuations are
% relatively large, therefore caution is taken and so an independent scale factor
% for the 2 and 3+jet categories is derived.


% The MVA, $m_{\textrm bb}$ distributions are compared in the Figure
% \ref{fig:compmva}, \ref{fig:compmbb} as they are variables considered in the
% fit; no significant slope can be found in the ratio.


% \figcompptv
% \figcompnjet
% \figcompmvaRed
% \figcompmbbRed

% \paragraph{Scale factors in each sample}
% \label{sssec:scalefactors_topsample}

% To check the consistency of the scale factors between samples listed in the
% Table \ref{tab:CompSamples}, the SR-\emucr{} comparisons were made for samples
% separately. 

% The comparisons in dilepton $t\bar{t}$, dilepton single top (Wt) and
% semi-leptonic $t\bar{t}$ are shown in the Figure \ref{fig:compTTbarDilep},
% \ref{fig:compStopWtDilep}, and \ref{fig:compTTbarSemilep}, respectively.

% While the ratios for dilepton $t\bar{t}$ and dilepton single top are around 1,
% they are, for semi-leptonic $t\bar{t}$ events, around 1.5 in 3+ jet category
% rather than 1 due to contribution from same sign ee events in the SRs.

% This scale factor of 1.5 can be explained via the following argument. Defining
% the fake rates of $qqbb$ reconstructed as $ebbj$/$\mu bbj$, including fake
% e/$\mu$, as $f(qqbb\rightarrow e^{\pm}bbj)$ and $f(qqbb\rightarrow\mu^{\pm}
% bbj)$, and the numbers of events at truth level as $N(e^{\pm}qqbb)$ and
% $N(\mu^{\pm}qqbb)$, then the true/reconstructed final states, and the expected
% yields in the SRs and \emucr{}s can be summarized as shown in Table
% \ref{tab:fakeSemilep}.


% Since $N(e^{\pm}qqbb)=N(\mu^{\pm}qqbb)=N(\ell^{\pm}qqbb)$, the expected yields
% of events are:

% \begin{align}
  
%   &SR:&&N(\ell^{\pm}qqbb)\cdot[f(qqbb\rightarrow e^{\mp}bbj)+f(qqbb\rightarrow \mu^{\mp}bbj)]+N(\ell^{\pm}qqbb)\cdot f(qqbb\rightarrow e^{\pm}bbj),\label{eq:samesigneeyield}\\
  
%   &{\textrm e\mu CRs}:&&N(\ell^{\pm}qqbb)\cdot[f(qqbb\rightarrow e^{\mp}bbj)+f(qqbb\rightarrow \mu^{\mp}bbj)].
                        
% \end{align}

% Since we are accepting same charged sign electron-pairs, $e^{\pm} e^{\pm}$
% events (as expressed via the second term of the equation
% \ref{eq:samesigneeyield}), it is expected that a scale factor of $\geq 1$ when
% considering the ratio of the SRs to \emucr{}s.


% The fake events from semi-leptonic $t\bar{t}$ are much less in the 2 jets
% category, since the scale factors for inclusive top samples should be different
% in 2 and 3+ jets categories, therefore it is required to have SFs for two
% categories separately.

% The impact on shapes by including semi-leptonic $t\bar{t}$ sample is confirmed
% to be less than stat uncertainty in the $m_{bb}$ and BDT distributions.

% \figcompSeparate
% \tabfakeSemilep

% \clearpage
% \subsubsection{Data-MC plots}
% \label{ssec:datamcDD}
% \figDataMC
% To check that the data-driven modeling of the top background describes the data
% distributions well, some data-MC plots are shown in Figure
% \ref{fig:DataMCmbb}-\ref{fig:DataMCptv}. In these plots the opposite to same
% lepton flavour extrapolation scale factors used for the data driven top
% background are summarised in Table \ref{tab:ScaleFactors}, and are detailed in
% Appendix \ref{ssec:comp2Lsrcrvar}. For the $Zbb+Zbc+Zbl+Zcc$ heavy flavour
% category, the MC prediction is scaled using the \Vhtobb ICHEP 2018 $80fb^{-1}$
% analysis scale factors obtained from the unconditional $\mu$ fit to data (se
% Ref. \cite{Aaboud:2018zhk}), which are summarized in the Table
% \ref{tab:ScaleFactors}.


% From Figure \ref{fig:DataMCmbb} it can be seen that the data/MC agreement
% demonstrates no statistically significant shape differences, as illustrated by
% the ratio pane of each $p^{V}_{T}$ and $n_{j}$ binned plot which shows the
% relative difference between the data and background estimates normalised to the
% background expectation. This trend is observed for the other Data/MC comparisons
% given by Figure \ref{fig:DataMCmva}-\ref{fig:DataMCptv}. Howeverit should be
% noted that whilst the shapes agree normalisation offsets like that seen in the
% 2-tag 2-jet $p^{V}_{T} > 150$GeV signal region (lower left pane of Figure
% \ref{fig:DataMCmbb}) are absorbed by the freely floating $Z+$jet heavy flavour
% normalisation nuisance parameter within the fit model, where variances of
% 20-30\% are not uncommon.


% \tabScaleFactors


\section{Systematic Uncertainties on Sub-Dominant Backgrounds}
\input{07-systematic-errors/small-bkg-table.tex}

\section{Systematic Uncertainties on the Signal Process}
\input{07-systematic-errors/signal-table.tex}

% \paragraph{Shape systematic Uncertainties post-processing} 

% In the current systematic model, independent normalization factors are employed
% for the main backgrounds (\ttbar, $\Wboson +$HF and $\Zboson +$HF) independently
% in $2$ and $3(+)$-jet, above or below $$p_T^V$ = 150~\GeV\$. Therefore, the
% extrapolation uncertainty is already accounted for at these boundaries. Most of
% the systematic uncertainties are computed in total $$p_T^V$$ phase space
% ($\geq75~\GeV$) in $2$-jet and $3$-jet events independently to avoid
% double-counting to the best possible. However, migrations at the $pTV=150~\GeV$
% are still possible, and differences in BDTr training and application setup or
% correlations could induce a small uncertainty componant accross jet bins. When
% visible, these effects are reduced with post-processing. The overall component
% of \ttbar ME, ttbar PS and \ttbar, $\Wboson +$HF, $\Zboson +$HF $p_T^V$
% uncertainties in the different jet bins, as well as in the bins
% $75~\GeV<$p_T^V$<150~\GeV$ and $$p_T^V$>150~\GeV$ is removed that way. \\


% Signal \mbb~shape uncertainty follow a similar but more refined treatment. In
% fact, the \VH signal is meant to have independent floating parameters in each
% STXS bin. Therefore, \VH~\mbb uncertainties are treated to have no overall
% impact in each jet and $p_T^V$ analysis bin, and act only as a shape on the
% discriminant, or as an extrapolation between signal and control regions. The
% same approach is adopted for di-boson \mbb uncertainties.

% \subsubsection{Smoothing of the Systematic Uncertainties}
% \label{sec:smooth}
% The uncertainties on reconstructed objects are propagated in the analysis in two
% different ways: by shifting weights, or by modifying the kinematic properties of
% the relevant objects and re-running the analysis chain. For flavour tagging,
% where a scale factor (SF) is used to correct efficiencies in the simulations to
% match those of data, the event weight is varied according to an upward
% (downward) shift of the SF and the change in the final distribution is noted as
% the +1 (-1) $\sigma$ uncertainties. For jet energy scale (JES) uncertainties,
% the jet energies are varied directly. Therefore events can migrate in and out of
% the analysis acceptance. Again the difference in the final discriminant is noted
% as the 1 $\sigma$ error. However, in the case of small variations and/or limited
% available MC statistics, the MC statistical uncertainty can make up a
% substantial part of this supposed systematic difference. Given that independent
% NP are introduce in the analysis to account for the MC statistical
% uncertainties, the inflation of systematic uncertainties due to limited
% statistic should be smoothed out.

% Two so-called ``smoothing'' algorithms are used to mitigate these effects. They
% have been developed for the Run 1 analysis and are based on the merging of
% consecutive bins in MC templates. Systematics templates are built as the ratios
% of varied to nominal MC templates. First, bins from one extremum to the next are
% merged until no local extrema remain in the BDT systematics template for the
% multi-variate analysis, or at most one extremum in the mbb systematics template
% for the cut-based analysis and well as the jet energy resolution systematics in
% the multi-variate analysis. This is an iterative process in which the merging
% performed at each step is chosen as the one for which the difference between
% merged and unmerged templates is smallest. Second, the bins resulting from this
% first algorithm are sequentially merged, starting from the upper end of the
% distribution, until the statistical uncertainty in each of the merged bins,
% calculated in the nominal template, is smaller than 5\%. In each of these merged
% bins, the nominal and systematically shifted contents are compared to give the
% $\pm1\sigma$ variation. This value is then used as the associated uncertainty
% for all the nominal bins in the corresponding merged bin.


% The smoothing procedure is applied to the uncertainties associated to:
% $e\gamma$, MET, muons, taus, jvt, jet, PRW and multi-jet modelling shapes. An
% example of the MET and JES systematics can be found in
% Figure~\ref{fig:Smoothing_Example}. The result of smoothing systematic
% uncertainties is checked to ensure that this is behaving as expected.

% % \begin{figure}[h]
% %   \centering
% %
%   \includegraphics[width=0.65\linewidth]{figures/stat/Smoothing/Region_BMax250_BMin150_Y6051_DSR_T2_L0_distmva_J2_VHSTXS_SysMET_SoftTrk_ResoPara.png}
% %
%   \includegraphics[width=0.65\linewidth]{figures/stat/Smoothing/Region_BMax250_BMin150_Y6051_DSR_T2_L0_distmBB_J3_VHSTXS_SysJET_CR_JET_EtaIntercalibration_Modelling.png}
% %      \caption{The variation in 0 lepton channel, 150\,\GeV$< p^{V}_{T}
% <$250\,\GeV region of the MET track-based soft term systematic in the
% multi-variate analysis (top) and the jet energy scale on eta-intercalibration
% systematic in the cut-based analysis (bottom). The dashed lines represent the
% systematic shape before smoothing and the solid lines represent the systematic
% shape after smoothing.}
% % \label{fig:Smoothing_Example}

% % \end{figure}


% \subsubsection{Pruning of the Systematic Uncertainties}
% \label{sec:smooth_prune}

% Several of the uncertainties described in Section~\ref{sec:npdefs} have a
% negligible effect on the distributions entering in the fit.  In addition,
% limited statistics in the MC nominal distributions can produce systematic
% templates with large fluctuations, introducing artificial variations in the fit.
% Therefore, following the Run 1 strategy, uncertainties are removed following a
% ``pruning'' procedure, which is carried out for each category/sub-channel in
% each region.

% Pruning is performed as follows: 
% \begin{itemize}
% \item Neglect the normalization uncertainty for a given sample in a region if either of the
%   following is true:
 
%  \begin{itemize}
%   \item the variation is less than 0.5\%
%   \item both up and down variations have the same sign
    
%  \end{itemize}

% \item Neglect the shape uncertainty for a given sample in a given region if the
%   following is true:
  
%  \begin{itemize}
%   \item not one single bin has a deviation over 0.5\% after the overall
%     normalization is removed
    
%   \item if only the up or the down variation is non-zero and passed the previous
%     pruning steps
    
%  \end{itemize}

% \item An additional pruning is made to remove systematic effects on small
%   samples in all regions. In any given region, that pruning is only applied to
%   samples contributing to less than $1\%$ of the total background and reads as
%   follow:
  
%  \begin{itemize}
%   \item in low sensitivity regions (no bin with $S/B>2\%$), normalization
%     effects below $5$ per mille of the total backgrounds and shapes varying no
%     bin by more than $5$ per mille of the total backgrounds are pruned
    
%   \item in regions where at least one bin has a signal contribution $>2\%$ of
%     the total background, shape and normalization effects are pruned if they
%     generate yield variations in these bins smaller than $2\%$ of the signal
%     yields in these bins
    
%  \end{itemize}
% \end{itemize}

% The list of pruned uncertainties is regularly checked to ensure that this is
% behaving as expected. The value of the threshold is also tested and compared to
% no-threshold for each stable iteration of the fit. This to ensure no
% over-pruning is made and the analysis sensitivity is not artificially increased.
